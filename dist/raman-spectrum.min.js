!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).RamanSpectrum={})}(this,(function(t){"use strict";const e=Object.prototype.toString;function r(t){return e.call(t).endsWith("Array]")}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var n={exports:{}};!function(t){!function(){function e(t){for(var e=0,o=t.length-1,i=void 0,s=void 0,a=void 0,l=n(e,o);;){if(o<=e)return t[l];if(o==e+1)return t[e]>t[o]&&r(t,e,o),t[l];for(t[i=n(e,o)]>t[o]&&r(t,i,o),t[e]>t[o]&&r(t,e,o),t[i]>t[e]&&r(t,i,e),r(t,i,e+1),s=e+1,a=o;;){do{s++}while(t[e]>t[s]);do{a--}while(t[a]>t[e]);if(a<s)break;r(t,s,a)}r(t,e,a),a<=l&&(e=s),a>=l&&(o=a-1)}}var r=function(t,e,r){var n;return n=[t[r],t[e]],t[e]=n[0],t[r]=n[1],n},n=function(t,e){return~~((t+e)/2)};t.exports?t.exports=e:window.median=e}()}(n);var o=n.exports;function i(t){if(!r(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");return o(t.slice())}function s(t,e){let n,o=!1;if(r(e)){if(t.length!==e.length)throw new Error("sub: size of array1 and array2 must be identical")}else o=!0,n=Number(e);let i=new Array(t.length);if(o)for(let e=0;e<t.length;e++)i[e]=t[e]+n;else for(let r=0;r<t.length;r++)i[r]=t[r]+e[r];return i}function a(t,e){let n,o=!1;if(r(e)){if(t.length!==e.length)throw new Error("sub: size of array1 and array2 must be identical")}else o=!0,n=Number(e);let i=new Float64Array(t.length);if(o)for(let e=0;e<t.length;e++)i[e]=t[e]*n;else for(let r=0;r<t.length;r++)i[r]=t[r]*e[r];return i}function l(t,e){let n,o=!1;if(r(e)){if(t.length!==e.length)throw new Error("sub: size of array1 and array2 must be identical")}else o=!0,n=Number(e);let i=new Array(t.length);if(o)for(let e=0;e<t.length;e++)i[e]=t[e]/n;else for(let r=0;r<t.length;r++)i[r]=t[r]/e[r];return i}function u(t,e){let r=0,n=t.length-1,o=0;for(;n-r>1;)if(o=r+(n-r>>1),t[o]<e)r=o;else{if(!(t[o]>e))return o;n=o}return r<t.length-1?Math.abs(e-t[r])<Math.abs(t[r+1]-e)?r:r+1:r}function h(t){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"!==h(t)||r(t)||(e=t,t=[]),!r(t))throw new TypeError("input must be an array");var n=e,o=n.from,i=void 0===o?0:o,s=n.to,a=void 0===s?10:s,l=n.size,u=void 0===l?t.length:l,c=n.step;if(0!==u&&c)throw new Error("step is defined by the array size");if(u||(u=c?Math.floor((a-i)/c)+1:a-i+1),!c&&u&&(c=(a-i)/(u-1)),Array.isArray(t)){t.length=0;for(var f=0;f<u;f++)t.push(i),i+=c}else{if(t.length!==u)throw new Error("sequentialFill typed array must have the correct length");for(var m=0;m<u;m++)t[m]=i,i+=c}return t}function f(t){if(t.length<=2)return!0;if(t[0]===t[1]){for(let e=1;e<t.length-1;e++)if(t[e]!==t[e+1])return!1;return!0}if(t[0]<t[t.length-1]){for(let e=0;e<t.length-1;e++)if(t[e]>=t[e+1])return!1}else for(let e=0;e<t.length-1;e++)if(t[e]<=t[e+1])return!1;return!0}function m(t){if(!r(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");for(var e=0,n=0;n<t.length;n++)e+=t[n];return e}function p(t){return m(t)/t.length}function g(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!r(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");var n=e.fromIndex,o=void 0===n?0:n,i=e.toIndex,s=void 0===i?t.length:i;if(o<0||o>=t.length||!Number.isInteger(o))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=o||s>t.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var a=t[o],l=o+1;l<s;l++)t[l]<a&&(a=t[l]);return a}function d(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!r(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");var n=e.fromIndex,o=void 0===n?0:n,i=e.toIndex,s=void 0===i?t.length:i;if(o<0||o>=t.length||!Number.isInteger(o))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=o||s>t.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var a=t[o],l=o+1;l<s;l++)t[l]>a&&(a=t[l]);return a}function w(t,e){let n,o=!1;if(r(e)){if(t.length!==e.length)throw new Error("sub: size of array1 and array2 must be identical")}else o=!0,n=Number(e);let i=new Array(t.length);if(o)for(let e=0;e<t.length;e++)i[e]=t[e]-n;else for(let r=0;r<t.length;r++)i[r]=t[r]-e[r];return i}function y(t={}){if(!r(t.x)||!r(t.y))throw new Error("Data must be an object of x and y arrays");if(t.x.length!==t.y.length)throw new Error("The x and y arrays mush have the same length")}function b(t={}){y(t);const e=Array.from(t.x),r=Array.from(t.y);let n=-1/0,o=[],i=[];for(let t=0;t<e.length;t++)n<e[t]&&(o.push(e[t]),i.push(r[t]),n=e[t]);return{x:o,y:i}}function v(t={}){y(t);const{x:e,y:r}=t,n=[],o=[];for(let t=0;t<e.length;t++)e[t]>0&&(n.push(e[t]),o.push(r[t]));return{x:n,y:o}}function x(t,e={}){y(t);const{x:r,y:n}=t;let{target:o,targetIndex:i}=e;void 0===i&&(i=void 0!==o?u(r,o):0);let s=Number.MIN_SAFE_INTEGER,a=i,l=n[i];for(;a!==s;)s=a,a>0&&n[a-1]>l?a--:a<r.length-1&&n[a+1]>l&&a++,l=n[a];return{x:r[a],y:n[a],index:a}}function M(t,e={}){y(t);const{x:r,y:n}=t;let{target:o,targetIndex:i}=e;void 0===i&&(i=void 0!==o?u(r,o):0);let s=Number.MIN_SAFE_INTEGER,a=i,l=n[i];for(;a!==s;)s=a,a>0&&n[a-1]<l?a--:a<r.length-1&&n[a+1]<l&&a++,l=n[a];return{x:r[a],y:n[a],index:a}}const E=-4*Math.LN2,A=Math.sqrt(Math.PI/Math.LN2),S=Math.sqrt(3),T=Math.sqrt(2*Math.LN2),k=Math.sqrt(2*Math.LN2)-1;function F(t){if(0===t)return 0;let e=Math.log(1-t*t),r=e/2+2/(.147*Math.PI),n=Math.sqrt(r**2-e/.147);return Math.sqrt(n-r)*(t>0?1:-1)}class N{constructor(t={}){this.fwhm=t.sd?N.widthToFWHM(2*t.sd):t.fwhm?t.fwhm:500,this.height=void 0===t.height?Math.sqrt(-E/Math.PI)/this.fwhm:t.height}getData(t={}){let{length:e,factor:r=this.getFactor()}=t;e||(e=Math.min(Math.ceil(this.fwhm*r),Math.pow(2,25)-1),e%2==0&&e++);const n=(e-1)/2,o=new Float64Array(e);for(let t=0;t<=n;t++)o[t]=this.fct(t-n)*this.height,o[e-1-t]=o[t];return o}fct(t){return N.fct(t,this.fwhm)}getFactor(t=.9999){return N.getFactor(t)}getArea(){return N.getArea(this.fwhm,{height:this.height})}widthToFWHM(t){return N.widthToFWHM(t)}fwhmToWidth(t=this.fwhm){return N.fwhmToWidth(t)}setFWHM(t){this.fwhm=t}setHeight(t){this.height=t}}N.fct=function(t,e=500){return Math.exp(E*Math.pow(t/e,2))},N.widthToFWHM=function(t){return t*T},N.fwhmToWidth=function(t){return t/T},N.getArea=function(t,e={}){let{height:r=1}=e;return r*A*t/2},N.getFactor=function(t=.9999){return Math.sqrt(2)*F(t)};class R{constructor(t={}){this.fwhm=void 0===t.fwhm?500:t.fwhm,this.height=void 0===t.height?2/Math.PI/this.fwhm:t.height}getData(t={}){let{length:e,factor:r=this.getFactor()}=t;e||(e=Math.min(Math.ceil(this.fwhm*r),Math.pow(2,25)-1),e%2==0&&e++);const n=(e-1)/2,o=new Float64Array(e);for(let t=0;t<=n;t++)o[t]=this.fct(t-n)*this.height,o[e-1-t]=o[t];return o}fct(t){return R.fct(t,this.fwhm)}getFactor(t=.9999){return R.getFactor(t)}getArea(){return R.getArea(this.fwhm,{height:this.height})}fwhmToWidth(t=this.fwhm){return R.fwhmToWidth(t)}widthToFWHM(t){return R.widthToFWHM(t)}setFWHM(t){this.fwhm=t}setHeight(t){this.height=t}}R.fct=function(t,e){const r=e*e;return r/(4*Math.pow(t,2)+r)},R.fwhmToWidth=function(t){return t/S},R.widthToFWHM=function(t){return t*S},R.getArea=function(t,e={}){let{height:r=1}=e;return r*Math.PI*t/2},R.getFactor=function(t=.9999){return 2*Math.tan(Math.PI*(t-.5))};class z{constructor(t={}){this.mu=void 0===t.mu?.5:t.mu,this.fwhm=void 0===t.fwhm?500:t.fwhm,this.height=void 0===t.height?1/(this.mu/Math.sqrt(-E/Math.PI)*this.fwhm+(1-this.mu)*this.fwhm*Math.PI/2):t.height}getData(t={}){let{length:e,factor:r=this.getFactor()}=t;e||(e=Math.ceil(this.fwhm*r),e%2==0&&e++);const n=(e-1)/2;let o=new Float64Array(e);for(let t=0;t<=n;t++)o[t]=this.fct(t-n)*this.height,o[e-1-t]=o[t];return o}fct(t){return z.fct(t,this.fwhm,this.mu)}getFactor(t=.9999,e=this.mu){return z.getFactor(t,e)}getArea(){return z.getArea(this.fwhm,{height:this.height,mu:this.mu})}widthToFWHM(t,e){return z.widthToFWHM(t,e)}fwhmToWidth(t=this.fwhm,e=this.mu){return z.fwhmToWidth(t,e)}setFWHM(t){this.fwhm=t}setHeight(t){this.height=t}setMu(t){this.mu=t}}z.fct=function(t,e,r=.5){return(1-r)*R.fct(t,e)+r*N.fct(t,e)},z.widthToFWHM=function(t,e=.5){return t*(e*k+1)},z.fwhmToWidth=function(t,e=.5){return t/(e*k+1)},z.getArea=function(t,e={}){let{height:r=1,mu:n=.5}=e;return t*r*(n*A+(1-n)*Math.PI)/2},z.getFactor=function(t=.9999,e=.5){return e<1?R.getFactor(t):N.getFactor(t)};let C=["x","y"];class I{constructor(t={}){let{fwhm:e=500}=t;for(let r of C){let n;n=t[r]?t[r].sd?I.widthToFWHM(2*t[r].sd):t[r].fwhm||e:e,this[r]={fwhm:n}}this.height=void 0===t.height?-E/Math.PI/this.x.fwhm/this.y.fwhm:t.height}getData(t={}){let{x:e={},y:r={},factor:n=this.getFactor(),length:o}=t,i=e.length||o;if(!i){let{factor:t=n}=e;i=Math.min(Math.ceil(this.x.fwhm*t),Math.pow(2,25)-1),i%2==0&&i++}let s=r.length||o;if(!s){let{factor:t=n}=r;s=Math.min(Math.ceil(this.y.fwhm*t),Math.pow(2,25)-1),s%2==0&&s++}const a=(i-1)/2,l=(s-1)/2,u=new Array(i);for(let t=0;t<i;t++)u[t]=new Array(s);for(let t=0;t<i;t++)for(let e=0;e<s;e++)u[t][e]=this.fct(t-a,e-l)*this.height;return u}fct(t,e){return I.fct(t,e,this.x.fwhm,this.y.fwhm)}getFactor(t=.9999){return I.getFactor(t)}getVolume(){return I.getVolume(this.x.fwhm,this.y.fwhm,{height:this.height})}widthToFWHM(t){return I.widthToFWHM(t)}fwhmToWidth(t=this.x.fwhm){return I.fwhmToWidth(t)}setFWHM(t,e){e||(e=C),Array.isArray(e)||(e=[e]);for(let r of e){let e=r.toLowerCase();if("y"!==e&&"x"!==e)throw new Error("axis label should be x or y");this[e].fwhm=t}}setHeight(t){this.height=t}}function $(t,e,r={}){let{windowSize:n=9,derivative:o=0,polynomial:i=3}=r;if(n%2==0||n<5||!Number.isInteger(n))throw new RangeError("Invalid window size (should be odd and at least 5 integer number)");if(n>t.length)throw new RangeError(`Window size is higher than the data length ${n}>${t.length}`);if(o<0||!Number.isInteger(o))throw new RangeError("Derivative should be a positive integer");if(i<1||!Number.isInteger(i))throw new RangeError("Polynomial should be a positive integer");i>=6&&console.warn("You should not use polynomial grade higher than 5 if you are not sure that your data arises from such a model. Possible polynomial oscillation problems");let s=Math.floor(n/2),a=t.length,l=new Array(a),u=function(t,e,r){let n=new Array(t),o=Math.floor(t/2);for(let i=-o;i<=o;i++){n[i+o]=new Array(t);for(let t=-o;t<=o;t++)n[i+o][t+o]=V(t,i,o,e,r)}return n}(n,i,o),h=0,c=!0;Array.isArray(e)?c=!1:h=Math.pow(e,o);for(let r=0;r<s;r++){let i=u[s-r-1],f=u[s+r+1],m=0,p=0;for(let e=0;e<n;e++)m+=i[e]*t[e],p+=f[e]*t[a-n+e];c?(l[s-r-1]=m/h,l[a-s+r]=p/h):(h=O(e,s-r-1,s,o),l[s-r-1]=m/h,h=O(e,a-s+r,s,o),l[a-s+r]=p/h)}let f=u[s];for(let r=n;r<=a;r++){let i=0;for(let e=0;e<n;e++)i+=f[e]*t[e+r-n];c||(h=O(e,r-s-1,s,o)),l[r-s-1]=i/h}return l}function O(t,e,r,n){let o=0,i=0;for(let n=e-r;n<e+r;n++)n>=0&&n<t.length-1&&(o+=t[n+1]-t[n],i++);return Math.pow(o/i,n)}function P(t,e,r,n){let o=0;return o=r>0?(4*r-2)/(r*(2*e-r+1))*(t*P(t,e,r-1,n)+n*P(t,e,r-1,n-1))-(r-1)*(2*e+r)/(r*(2*e-r+1))*P(t,e,r-2,n):0===r&&0===n?1:0,o}function U(t,e){let r=1;if(t>=e)for(let n=t-e+1;n<=t;n++)r*=n;return r}function V(t,e,r,n,o){let i=0;for(let s=0;s<=n;s++)i+=(2*s+1)*(U(2*r,s)/U(2*r+s+1,s+1))*P(t,r,s,0)*P(e,r,s,o);return i}function D(t,e={}){let{noiseLevel:r,sgOptions:n={windowSize:9,polynomial:3},shape:o={},smoothY:i=!0,heightFactor:s=0,broadRatio:a=0,maxCriteria:l=!0,minMaxRatio:u=25e-5,derivativeThreshold:h=-1,realTopDetection:c=!1}=e,{y:f,x:m}=t;const p=f.slice();let g=L(m);if(!1===l)for(let t=0;t<p.length;t++)p[t]*=-1;void 0===r&&(r=g?X(p):0);for(let t=0;t<p.length;t++)p[t]-=r;for(let t=0;t<p.length;t++)p[t]<0&&(p[t]=0);let d,w,y=p;const{windowSize:b,polynomial:v}=n;g?(i&&(y=$(p,m[1]-m[0],{windowSize:b,polynomial:v,derivative:0})),d=$(p,m[1]-m[0],{windowSize:b,polynomial:v,derivative:1}),w=$(p,m[1]-m[0],{windowSize:b,polynomial:v,derivative:2})):(i&&(y=$(p,m,{windowSize:b,polynomial:v,derivative:0})),d=$(p,m,{windowSize:b,polynomial:v,derivative:1}),w=$(p,m,{windowSize:b,polynomial:v,derivative:2}));const x=m,M=m[1]-m[0];let E=0,A=0;for(let t=0;t<y.length;t++)Math.abs(w[t])>E&&(E=Math.abs(w[t])),Math.abs(y[t])>A&&(A=Math.abs(y[t]));let S=null,T=null,k=[],F=[],C=[],O=[];for(let t=1;t<y.length-1;++t)Math.abs(d[t])>h&&((d[t]<d[t-1]&&d[t]<=d[t+1]||d[t]<=d[t-1]&&d[t]<d[t+1])&&(T={x:x[t],index:t},M>0&&null!==S&&(F.push(S),C.push(T))),(d[t]>=d[t-1]&&d[t]>d[t+1]||d[t]>d[t-1]&&d[t]>=d[t+1])&&(S={x:x[t],index:t},M<0&&null!==T&&(F.push(S),C.push(T)))),w[t]<w[t-1]&&w[t]<w[t+1]&&(k.push(t),O.push(Math.abs(w[t])<=a*E));let P,U,V,D,_,j=o.kind?function(t){let{kind:e="Gaussian",options:r}=t;switch(e.toLowerCase().replace(/[^a-z^0-9]/g,"")){case"gaussian":return new N(r);case"lorentzian":return new R(r);case"pseudovoigt":return new z(r);case"gaussian2d":return new I(r);default:throw new Error(`Unknown kind: ${e}`)}}(o.kind,o.options).widthToFWHM:t=>t,Y=[],W=-1;for(let t=0;t<k.length;++t){U=x[k[t]],P=-1;let e=W+1;for(D=Number.MAX_VALUE,V=0,_=!0;-1===P&&e<F.length&&_;)V=Math.abs(U-(F[e].x+C[e].x)/2),V<D?D=V:_=!1,V<Math.abs(F[e].x-C[e].x)/2&&(P=e,W=e),++e;if(-1!==P&&Math.abs(y[k[t]])>u*A){let e=Math.abs(C[P].x-F[P].x);if(Y.push({index:k[t],x:U,y:l?y[k[t]]+r:-y[k[t]]-r,width:j(e),soft:O[t]}),Y[Y.length-1].left=F[P],Y[Y.length-1].right=C[P],s){let t=y[F[P].index],e=y[C[P].index];Y[Y.length-1].height=s*(Y[Y.length-1].y-(t+e)/2)}}}c&&q(Y,x,y);for(let t=0;t<Y.length;t++)Y[t].base=r;return Y.sort((function(t,e){return t.x-e.x})),Y}I.fct=function(t,e,r=500,n=500){return Math.exp(E*(Math.pow(t/r,2)+Math.pow(e/n,2)))},I.widthToFWHM=function(t){return t*T},I.fwhmToWidth=function(t){return t/T},I.getVolume=function(t,e,r={}){let{height:n=1}=r;return n*Math.PI*t*e/Math.LN2/4},I.getFactor=function(t=.9999){return Math.sqrt(2)*F(t)};const L=t=>{let e,r=0,n=Number.MAX_SAFE_INTEGER;for(let o=0;o<t.length-1;++o)e=Math.abs(t[o+1]-t[o]),e<n&&(n=e),e>r&&(r=e);return(r-n)/r<.05},X=t=>{let e=0,r=0,n=t.length;for(let r=0;r<n;++r)e+=t[r];e/=n;let o=new Array(n);for(let r=0;r<n;++r)o[r]=Math.abs(t[r]-e);return o.sort(((t,e)=>t-e)),r=n%2==1?o[(n-1)/2]/.6745:.5*(o[n/2]+o[n/2-1])/.6745,r},q=(t,e,r)=>{let n,o,i,s,a;for(let l=0;l<t.length;l++)a=t[l].index,r[a-1]>=r[a-2]&&r[a-1]>=r[a]?a--:r[a+1]>=r[a]&&r[a+1]>=r[a+2]?a++:r[a-2]>=r[a-3]&&r[a-2]>=r[a-1]?a-=2:r[a+2]>=r[a+1]&&r[a+2]>=r[a+3]&&(a+=2),r[a-1]>0&&r[a+1]>0&&r[a]>=r[a-1]&&r[a]>=r[a+1]&&(r[a]!==r[a-1]||r[a]!==r[a+1])&&(n=20*Math.log10(r[a-1]),o=20*Math.log10(r[a]),i=20*Math.log10(r[a+1]),s=.5*(n-i)/(n-2*o+i),t[l].x=e[a]+(e[a]-e[a-1])*s,t[l].y=r[a]-.25*(r[a-1]-r[a+1])*s)};function _(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!r(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");if(void 0!==n.output){if(!r(n.output))throw new TypeError("output option must be an array if specified");e=n.output}else e=new Array(t.length);var o=g(t),i=d(t);if(o===i)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var s=n.min,a=void 0===s?n.autoMinMax?o:0:s,l=n.max,u=void 0===l?n.autoMinMax?i:1:l;if(a>=u)throw new RangeError("min option must be smaller than max option");for(var h=(u-a)/(i-o),c=0;c<t.length;c++)e[c]=(t[c]-o)*h+a;return e}const j=" ".repeat(2),Y=" ".repeat(4);function W(t,e={}){const{maxRows:r=15,maxColumns:n=10,maxNumSize:o=8}=e;return`${t.constructor.name} {\n${j}[\n${Y}${function(t,e,r,n){const{rows:o,columns:i}=t,s=Math.min(o,e),a=Math.min(i,r),l=[];for(let e=0;e<s;e++){let r=[];for(let o=0;o<a;o++)r.push(B(t.get(e,o),n));l.push(`${r.join(" ")}`)}a!==i&&(l[l.length-1]+=` ... ${i-r} more columns`);s!==o&&l.push(`... ${o-e} more rows`);return l.join(`\n${Y}`)}(t,r,n,o)}\n${j}]\n${j}rows: ${t.rows}\n${j}columns: ${t.columns}\n}`}function B(t,e){const r=String(t);if(r.length<=e)return r.padEnd(e," ");const n=t.toPrecision(e-2);if(n.length<=e)return n;const o=t.toExponential(e-2),i=o.indexOf("e"),s=o.slice(i);return o.slice(0,e-s.length)+s}function H(t,e,r){let n=r?t.rows:t.rows-1;if(e<0||e>n)throw new RangeError("Row index out of range")}function K(t,e,r){let n=r?t.columns:t.columns-1;if(e<0||e>n)throw new RangeError("Column index out of range")}function G(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function Z(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function J(t,e){if("object"!=typeof e)throw new TypeError("unexpected type for row indices");if(e.some((e=>e<0||e>=t.rows)))throw new RangeError("row indices are out of range");return Array.isArray(e)||(e=Array.from(e)),e}function Q(t,e){if("object"!=typeof e)throw new TypeError("unexpected type for column indices");if(e.some((e=>e<0||e>=t.columns)))throw new RangeError("column indices are out of range");return Array.isArray(e)||(e=Array.from(e)),e}function tt(t,e,r,n,o){if(5!==arguments.length)throw new RangeError("expected 4 arguments");if(rt("startRow",e),rt("endRow",r),rt("startColumn",n),rt("endColumn",o),e>r||n>o||e<0||e>=t.rows||r<0||r>=t.rows||n<0||n>=t.columns||o<0||o>=t.columns)throw new RangeError("Submatrix indices are out of range")}function et(t,e=0){let r=[];for(let n=0;n<t;n++)r.push(e);return r}function rt(t,e){if("number"!=typeof e)throw new TypeError(`${t} must be a number`)}function nt(t){if(t.isEmpty())throw new Error("Empty matrix has no elements to index")}class ot{static from1DArray(t,e,r){if(t*e!==r.length)throw new RangeError("data length does not match given dimensions");let n=new st(t,e);for(let o=0;o<t;o++)for(let t=0;t<e;t++)n.set(o,t,r[o*e+t]);return n}static rowVector(t){let e=new st(1,t.length);for(let r=0;r<t.length;r++)e.set(0,r,t[r]);return e}static columnVector(t){let e=new st(t.length,1);for(let r=0;r<t.length;r++)e.set(r,0,t[r]);return e}static zeros(t,e){return new st(t,e)}static ones(t,e){return new st(t,e).fill(1)}static rand(t,e,r={}){if("object"!=typeof r)throw new TypeError("options must be an object");const{random:n=Math.random}=r;let o=new st(t,e);for(let r=0;r<t;r++)for(let t=0;t<e;t++)o.set(r,t,n());return o}static randInt(t,e,r={}){if("object"!=typeof r)throw new TypeError("options must be an object");const{min:n=0,max:o=1e3,random:i=Math.random}=r;if(!Number.isInteger(n))throw new TypeError("min must be an integer");if(!Number.isInteger(o))throw new TypeError("max must be an integer");if(n>=o)throw new RangeError("min must be smaller than max");let s=o-n,a=new st(t,e);for(let r=0;r<t;r++)for(let t=0;t<e;t++){let e=n+Math.round(i()*s);a.set(r,t,e)}return a}static eye(t,e,r){void 0===e&&(e=t),void 0===r&&(r=1);let n=Math.min(t,e),o=this.zeros(t,e);for(let t=0;t<n;t++)o.set(t,t,r);return o}static diag(t,e,r){let n=t.length;void 0===e&&(e=n),void 0===r&&(r=e);let o=Math.min(n,e,r),i=this.zeros(e,r);for(let e=0;e<o;e++)i.set(e,e,t[e]);return i}static min(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let r=t.rows,n=t.columns,o=new st(r,n);for(let i=0;i<r;i++)for(let r=0;r<n;r++)o.set(i,r,Math.min(t.get(i,r),e.get(i,r)));return o}static max(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let r=t.rows,n=t.columns,o=new this(r,n);for(let i=0;i<r;i++)for(let r=0;r<n;r++)o.set(i,r,Math.max(t.get(i,r),e.get(i,r)));return o}static checkMatrix(t){return ot.isMatrix(t)?t:new st(t)}static isMatrix(t){return null!=t&&"Matrix"===t.klass}get size(){return this.rows*this.columns}apply(t){if("function"!=typeof t)throw new TypeError("callback must be a function");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.call(this,e,r);return this}to1DArray(){let t=[];for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.push(this.get(e,r));return t}to2DArray(){let t=[];for(let e=0;e<this.rows;e++){t.push([]);for(let r=0;r<this.columns;r++)t[e].push(this.get(e,r))}return t}toJSON(){return this.to2DArray()}isRowVector(){return 1===this.rows}isColumnVector(){return 1===this.columns}isVector(){return 1===this.rows||1===this.columns}isSquare(){return this.rows===this.columns}isEmpty(){return 0===this.rows||0===this.columns}isSymmetric(){if(this.isSquare()){for(let t=0;t<this.rows;t++)for(let e=0;e<=t;e++)if(this.get(t,e)!==this.get(e,t))return!1;return!0}return!1}isEchelonForm(){let t=0,e=0,r=-1,n=!0,o=!1;for(;t<this.rows&&n;){for(e=0,o=!1;e<this.columns&&!1===o;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>r?(o=!0,r=e):(n=!1,o=!0);t++}return n}isReducedEchelonForm(){let t=0,e=0,r=-1,n=!0,o=!1;for(;t<this.rows&&n;){for(e=0,o=!1;e<this.columns&&!1===o;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>r?(o=!0,r=e):(n=!1,o=!0);for(let r=e+1;r<this.rows;r++)0!==this.get(t,r)&&(n=!1);t++}return n}echelonForm(){let t=this.clone(),e=0,r=0;for(;e<t.rows&&r<t.columns;){let n=e;for(let o=e;o<t.rows;o++)t.get(o,r)>t.get(n,r)&&(n=o);if(0===t.get(n,r))r++;else{t.swapRows(e,n);let o=t.get(e,r);for(let n=r;n<t.columns;n++)t.set(e,n,t.get(e,n)/o);for(let n=e+1;n<t.rows;n++){let o=t.get(n,r)/t.get(e,r);t.set(n,r,0);for(let i=r+1;i<t.columns;i++)t.set(n,i,t.get(n,i)-t.get(e,i)*o)}e++,r++}}return t}reducedEchelonForm(){let t=this.echelonForm(),e=t.columns,r=t.rows,n=r-1;for(;n>=0;)if(0===t.maxRow(n))n--;else{let o=0,i=!1;for(;o<r&&!1===i;)1===t.get(n,o)?i=!0:o++;for(let r=0;r<n;r++){let i=t.get(r,o);for(let s=o;s<e;s++){let e=t.get(r,s)-i*t.get(n,s);t.set(r,s,e)}}n--}return t}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{rows:e=1,columns:r=1}=t;if(!Number.isInteger(e)||e<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(r)||r<=0)throw new TypeError("columns must be a positive integer");let n=new st(this.rows*e,this.columns*r);for(let t=0;t<e;t++)for(let e=0;e<r;e++)n.setSubMatrix(this,this.rows*t,this.columns*e);return n}fill(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,t);return this}neg(){return this.mulS(-1)}getRow(t){H(this,t);let e=[];for(let r=0;r<this.columns;r++)e.push(this.get(t,r));return e}getRowVector(t){return st.rowVector(this.getRow(t))}setRow(t,e){H(this,t),e=G(this,e);for(let r=0;r<this.columns;r++)this.set(t,r,e[r]);return this}swapRows(t,e){H(this,t),H(this,e);for(let r=0;r<this.columns;r++){let n=this.get(t,r);this.set(t,r,this.get(e,r)),this.set(e,r,n)}return this}getColumn(t){K(this,t);let e=[];for(let r=0;r<this.rows;r++)e.push(this.get(r,t));return e}getColumnVector(t){return st.columnVector(this.getColumn(t))}setColumn(t,e){K(this,t),e=Z(this,e);for(let r=0;r<this.rows;r++)this.set(r,t,e[r]);return this}swapColumns(t,e){K(this,t),K(this,e);for(let r=0;r<this.rows;r++){let n=this.get(r,t);this.set(r,t,this.get(r,e)),this.set(r,e,n)}return this}addRowVector(t){t=G(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t[r]);return this}subRowVector(t){t=G(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t[r]);return this}mulRowVector(t){t=G(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t[r]);return this}divRowVector(t){t=G(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t[r]);return this}addColumnVector(t){t=Z(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t[e]);return this}subColumnVector(t){t=Z(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t[e]);return this}mulColumnVector(t){t=Z(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t[e]);return this}divColumnVector(t){t=Z(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t[e]);return this}mulRow(t,e){H(this,t);for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)*e);return this}mulColumn(t,e){K(this,t);for(let r=0;r<this.rows;r++)this.set(r,t,this.get(r,t)*e);return this}max(){if(this.isEmpty())return NaN;let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)>t&&(t=this.get(e,r));return t}maxIndex(){nt(this);let t=this.get(0,0),e=[0,0];for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.get(r,n)>t&&(t=this.get(r,n),e[0]=r,e[1]=n);return e}min(){if(this.isEmpty())return NaN;let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)<t&&(t=this.get(e,r));return t}minIndex(){nt(this);let t=this.get(0,0),e=[0,0];for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.get(r,n)<t&&(t=this.get(r,n),e[0]=r,e[1]=n);return e}maxRow(t){if(H(this,t),this.isEmpty())return NaN;let e=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)>e&&(e=this.get(t,r));return e}maxRowIndex(t){H(this,t),nt(this);let e=this.get(t,0),r=[t,0];for(let n=1;n<this.columns;n++)this.get(t,n)>e&&(e=this.get(t,n),r[1]=n);return r}minRow(t){if(H(this,t),this.isEmpty())return NaN;let e=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)<e&&(e=this.get(t,r));return e}minRowIndex(t){H(this,t),nt(this);let e=this.get(t,0),r=[t,0];for(let n=1;n<this.columns;n++)this.get(t,n)<e&&(e=this.get(t,n),r[1]=n);return r}maxColumn(t){if(K(this,t),this.isEmpty())return NaN;let e=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)>e&&(e=this.get(r,t));return e}maxColumnIndex(t){K(this,t),nt(this);let e=this.get(0,t),r=[0,t];for(let n=1;n<this.rows;n++)this.get(n,t)>e&&(e=this.get(n,t),r[0]=n);return r}minColumn(t){if(K(this,t),this.isEmpty())return NaN;let e=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)<e&&(e=this.get(r,t));return e}minColumnIndex(t){K(this,t),nt(this);let e=this.get(0,t),r=[0,t];for(let n=1;n<this.rows;n++)this.get(n,t)<e&&(e=this.get(n,t),r[0]=n);return r}diag(){let t=Math.min(this.rows,this.columns),e=[];for(let r=0;r<t;r++)e.push(this.get(r,r));return e}norm(t="frobenius"){let e=0;if("max"===t)return this.max();if("frobenius"===t){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)e+=this.get(t,r)*this.get(t,r);return Math.sqrt(e)}throw new RangeError(`unknown norm type: ${t}`)}cumulativeSum(){let t=0;for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t+=this.get(e,r),this.set(e,r,t);return this}dot(t){ot.isMatrix(t)&&(t=t.to1DArray());let e=this.to1DArray();if(e.length!==t.length)throw new RangeError("vectors do not have the same size");let r=0;for(let n=0;n<e.length;n++)r+=e[n]*t[n];return r}mmul(t){t=st.checkMatrix(t);let e=this.rows,r=this.columns,n=t.columns,o=new st(e,n),i=new Float64Array(r);for(let s=0;s<n;s++){for(let e=0;e<r;e++)i[e]=t.get(e,s);for(let t=0;t<e;t++){let e=0;for(let n=0;n<r;n++)e+=this.get(t,n)*i[n];o.set(t,s,e)}}return o}strassen2x2(t){t=st.checkMatrix(t);let e=new st(2,2);const r=this.get(0,0),n=t.get(0,0),o=this.get(0,1),i=t.get(0,1),s=this.get(1,0),a=t.get(1,0),l=this.get(1,1),u=t.get(1,1),h=(r+l)*(n+u),c=(s+l)*n,f=r*(i-u),m=l*(a-n),p=(r+o)*u,g=h+m-p+(o-l)*(a+u),d=f+p,w=c+m,y=h-c+f+(s-r)*(n+i);return e.set(0,0,g),e.set(0,1,d),e.set(1,0,w),e.set(1,1,y),e}strassen3x3(t){t=st.checkMatrix(t);let e=new st(3,3);const r=this.get(0,0),n=this.get(0,1),o=this.get(0,2),i=this.get(1,0),s=this.get(1,1),a=this.get(1,2),l=this.get(2,0),u=this.get(2,1),h=this.get(2,2),c=t.get(0,0),f=t.get(0,1),m=t.get(0,2),p=t.get(1,0),g=t.get(1,1),d=t.get(1,2),w=t.get(2,0),y=t.get(2,1),b=t.get(2,2),v=(r-i)*(-f+g),x=(-r+i+s)*(c-f+g),M=(i+s)*(-c+f),E=r*c,A=(-r+l+u)*(c-m+d),S=(-r+l)*(m-d),T=(l+u)*(-c+m),k=(-o+u+h)*(g+w-y),F=(o-h)*(g-y),N=o*w,R=(u+h)*(-w+y),z=(-o+s+a)*(d+w-b),C=(o-a)*(d-b),I=(s+a)*(-w+b),$=E+N+n*p,O=(r+n+o-i-s-u-h)*g+x+M+E+k+N+R,P=E+A+T+(r+n+o-s-a-l-u)*d+N+z+I,U=v+s*(-c+f+p-g-d-w+b)+x+E+N+z+C,V=v+x+M+E+a*y,D=N+z+C+I+i*m,L=E+A+S+u*(-c+m+p-g-d-w+y)+k+F+N,X=k+F+N+R+l*f,q=E+A+S+T+h*b;return e.set(0,0,$),e.set(0,1,O),e.set(0,2,P),e.set(1,0,U),e.set(1,1,V),e.set(1,2,D),e.set(2,0,L),e.set(2,1,X),e.set(2,2,q),e}mmulStrassen(t){t=st.checkMatrix(t);let e=this.clone(),r=e.rows,n=e.columns,o=t.rows,i=t.columns;function s(t,e,r){let n=t.rows,o=t.columns;if(n===e&&o===r)return t;{let n=ot.zeros(e,r);return n=n.setSubMatrix(t,0,0),n}}n!==o&&console.warn(`Multiplying ${r} x ${n} and ${o} x ${i} matrix: dimensions do not match.`);let a=Math.max(r,o),l=Math.max(n,i);return e=s(e,a,l),function t(e,r,n,o){if(n<=512||o<=512)return e.mmul(r);n%2==1&&o%2==1?(e=s(e,n+1,o+1),r=s(r,n+1,o+1)):n%2==1?(e=s(e,n+1,o),r=s(r,n+1,o)):o%2==1&&(e=s(e,n,o+1),r=s(r,n,o+1));let i=parseInt(e.rows/2,10),a=parseInt(e.columns/2,10),l=e.subMatrix(0,i-1,0,a-1),u=r.subMatrix(0,i-1,0,a-1),h=e.subMatrix(0,i-1,a,e.columns-1),c=r.subMatrix(0,i-1,a,r.columns-1),f=e.subMatrix(i,e.rows-1,0,a-1),m=r.subMatrix(i,r.rows-1,0,a-1),p=e.subMatrix(i,e.rows-1,a,e.columns-1),g=r.subMatrix(i,r.rows-1,a,r.columns-1),d=t(ot.add(l,p),ot.add(u,g),i,a),w=t(ot.add(f,p),u,i,a),y=t(l,ot.sub(c,g),i,a),b=t(p,ot.sub(m,u),i,a),v=t(ot.add(l,h),g,i,a),x=t(ot.sub(f,l),ot.add(u,c),i,a),M=t(ot.sub(h,p),ot.add(m,g),i,a),E=ot.add(d,b);E.sub(v),E.add(M);let A=ot.add(y,v),S=ot.add(w,b),T=ot.sub(d,w);T.add(y),T.add(x);let k=ot.zeros(2*E.rows,2*E.columns);return k=k.setSubMatrix(E,0,0),k=k.setSubMatrix(A,E.rows,0),k=k.setSubMatrix(S,0,E.columns),k=k.setSubMatrix(T,E.rows,E.columns),k.subMatrix(0,n-1,0,o-1)}(e,t=s(t,a,l),a,l)}scaleRows(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:r=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(e>=r)throw new RangeError("min must be smaller than max");let n=new st(this.rows,this.columns);for(let t=0;t<this.rows;t++){const o=this.getRow(t);o.length>0&&_(o,{min:e,max:r,output:o}),n.setRow(t,o)}return n}scaleColumns(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:r=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(e>=r)throw new RangeError("min must be smaller than max");let n=new st(this.rows,this.columns);for(let t=0;t<this.columns;t++){const o=this.getColumn(t);o.length&&_(o,{min:e,max:r,output:o}),n.setColumn(t,o)}return n}flipRows(){const t=Math.ceil(this.columns/2);for(let e=0;e<this.rows;e++)for(let r=0;r<t;r++){let t=this.get(e,r),n=this.get(e,this.columns-1-r);this.set(e,r,n),this.set(e,this.columns-1-r,t)}return this}flipColumns(){const t=Math.ceil(this.rows/2);for(let e=0;e<this.columns;e++)for(let r=0;r<t;r++){let t=this.get(r,e),n=this.get(this.rows-1-r,e);this.set(r,e,n),this.set(this.rows-1-r,e,t)}return this}kroneckerProduct(t){t=st.checkMatrix(t);let e=this.rows,r=this.columns,n=t.rows,o=t.columns,i=new st(e*n,r*o);for(let s=0;s<e;s++)for(let e=0;e<r;e++)for(let r=0;r<n;r++)for(let a=0;a<o;a++)i.set(n*s+r,o*e+a,this.get(s,e)*t.get(r,a));return i}kroneckerSum(t){if(t=st.checkMatrix(t),!this.isSquare()||!t.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let e=this.rows,r=t.rows,n=this.kroneckerProduct(st.eye(r,r)),o=st.eye(e,e).kroneckerProduct(t);return n.add(o)}transpose(){let t=new st(this.columns,this.rows);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.set(r,e,this.get(e,r));return t}sortRows(t=it){for(let e=0;e<this.rows;e++)this.setRow(e,this.getRow(e).sort(t));return this}sortColumns(t=it){for(let e=0;e<this.columns;e++)this.setColumn(e,this.getColumn(e).sort(t));return this}subMatrix(t,e,r,n){tt(this,t,e,r,n);let o=new st(e-t+1,n-r+1);for(let i=t;i<=e;i++)for(let e=r;e<=n;e++)o.set(i-t,e-r,this.get(i,e));return o}subMatrixRow(t,e,r){if(void 0===e&&(e=0),void 0===r&&(r=this.columns-1),e>r||e<0||e>=this.columns||r<0||r>=this.columns)throw new RangeError("Argument out of range");let n=new st(t.length,r-e+1);for(let o=0;o<t.length;o++)for(let i=e;i<=r;i++){if(t[o]<0||t[o]>=this.rows)throw new RangeError(`Row index out of range: ${t[o]}`);n.set(o,i-e,this.get(t[o],i))}return n}subMatrixColumn(t,e,r){if(void 0===e&&(e=0),void 0===r&&(r=this.rows-1),e>r||e<0||e>=this.rows||r<0||r>=this.rows)throw new RangeError("Argument out of range");let n=new st(r-e+1,t.length);for(let o=0;o<t.length;o++)for(let i=e;i<=r;i++){if(t[o]<0||t[o]>=this.columns)throw new RangeError(`Column index out of range: ${t[o]}`);n.set(i-e,o,this.get(i,t[o]))}return n}setSubMatrix(t,e,r){if((t=st.checkMatrix(t)).isEmpty())return this;tt(this,e,e+t.rows-1,r,r+t.columns-1);for(let n=0;n<t.rows;n++)for(let o=0;o<t.columns;o++)this.set(e+n,r+o,t.get(n,o));return this}selection(t,e){let r=function(t,e,r){return{row:J(t,e),column:Q(t,r)}}(this,t,e),n=new st(t.length,e.length);for(let t=0;t<r.row.length;t++){let e=r.row[t];for(let o=0;o<r.column.length;o++){let i=r.column[o];n.set(t,o,this.get(e,i))}}return n}trace(){let t=Math.min(this.rows,this.columns),e=0;for(let r=0;r<t;r++)e+=this.get(r,r);return e}clone(){let t=new st(this.rows,this.columns);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.set(e,r,this.get(e,r));return t}sum(t){switch(t){case"row":return function(t){let e=et(t.rows);for(let r=0;r<t.rows;++r)for(let n=0;n<t.columns;++n)e[r]+=t.get(r,n);return e}(this);case"column":return function(t){let e=et(t.columns);for(let r=0;r<t.rows;++r)for(let n=0;n<t.columns;++n)e[n]+=t.get(r,n);return e}(this);case void 0:return function(t){let e=0;for(let r=0;r<t.rows;r++)for(let n=0;n<t.columns;n++)e+=t.get(r,n);return e}(this);default:throw new Error(`invalid option: ${t}`)}}product(t){switch(t){case"row":return function(t){let e=et(t.rows,1);for(let r=0;r<t.rows;++r)for(let n=0;n<t.columns;++n)e[r]*=t.get(r,n);return e}(this);case"column":return function(t){let e=et(t.columns,1);for(let r=0;r<t.rows;++r)for(let n=0;n<t.columns;++n)e[n]*=t.get(r,n);return e}(this);case void 0:return function(t){let e=1;for(let r=0;r<t.rows;r++)for(let n=0;n<t.columns;n++)e*=t.get(r,n);return e}(this);default:throw new Error(`invalid option: ${t}`)}}mean(t){const e=this.sum(t);switch(t){case"row":for(let t=0;t<this.rows;t++)e[t]/=this.columns;return e;case"column":for(let t=0;t<this.columns;t++)e[t]/=this.rows;return e;case void 0:return e/this.size;default:throw new Error(`invalid option: ${t}`)}}variance(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{unbiased:r=!0,mean:n=this.mean(t)}=e;if("boolean"!=typeof r)throw new TypeError("unbiased must be a boolean");switch(t){case"row":if(!Array.isArray(n))throw new TypeError("mean must be an array");return function(t,e,r){const n=t.rows,o=t.columns,i=[];for(let s=0;s<n;s++){let n=0,a=0,l=0;for(let e=0;e<o;e++)l=t.get(s,e)-r[s],n+=l,a+=l*l;e?i.push((a-n*n/o)/(o-1)):i.push((a-n*n/o)/o)}return i}(this,r,n);case"column":if(!Array.isArray(n))throw new TypeError("mean must be an array");return function(t,e,r){const n=t.rows,o=t.columns,i=[];for(let s=0;s<o;s++){let o=0,a=0,l=0;for(let e=0;e<n;e++)l=t.get(e,s)-r[s],o+=l,a+=l*l;e?i.push((a-o*o/n)/(n-1)):i.push((a-o*o/n)/n)}return i}(this,r,n);case void 0:if("number"!=typeof n)throw new TypeError("mean must be a number");return function(t,e,r){const n=t.rows,o=t.columns,i=n*o;let s=0,a=0,l=0;for(let e=0;e<n;e++)for(let n=0;n<o;n++)l=t.get(e,n)-r,s+=l,a+=l*l;return e?(a-s*s/i)/(i-1):(a-s*s/i)/i}(this,r,n);default:throw new Error(`invalid option: ${t}`)}}standardDeviation(t,e){"object"==typeof t&&(e=t,t=void 0);const r=this.variance(t,e);if(void 0===t)return Math.sqrt(r);for(let t=0;t<r.length;t++)r[t]=Math.sqrt(r[t]);return r}center(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{center:r=this.mean(t)}=e;switch(t){case"row":if(!Array.isArray(r))throw new TypeError("center must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let n=0;n<t.columns;n++)t.set(r,n,t.get(r,n)-e[r])}(this,r),this;case"column":if(!Array.isArray(r))throw new TypeError("center must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let n=0;n<t.columns;n++)t.set(r,n,t.get(r,n)-e[n])}(this,r),this;case void 0:if("number"!=typeof r)throw new TypeError("center must be a number");return function(t,e){for(let r=0;r<t.rows;r++)for(let n=0;n<t.columns;n++)t.set(r,n,t.get(r,n)-e)}(this,r),this;default:throw new Error(`invalid option: ${t}`)}}scale(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");let r=e.scale;switch(t){case"row":if(void 0===r)r=function(t){const e=[];for(let r=0;r<t.rows;r++){let n=0;for(let e=0;e<t.columns;e++)n+=Math.pow(t.get(r,e),2)/(t.columns-1);e.push(Math.sqrt(n))}return e}(this);else if(!Array.isArray(r))throw new TypeError("scale must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let n=0;n<t.columns;n++)t.set(r,n,t.get(r,n)/e[r])}(this,r),this;case"column":if(void 0===r)r=function(t){const e=[];for(let r=0;r<t.columns;r++){let n=0;for(let e=0;e<t.rows;e++)n+=Math.pow(t.get(e,r),2)/(t.rows-1);e.push(Math.sqrt(n))}return e}(this);else if(!Array.isArray(r))throw new TypeError("scale must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let n=0;n<t.columns;n++)t.set(r,n,t.get(r,n)/e[n])}(this,r),this;case void 0:if(void 0===r)r=function(t){const e=t.size-1;let r=0;for(let n=0;n<t.columns;n++)for(let o=0;o<t.rows;o++)r+=Math.pow(t.get(o,n),2)/e;return Math.sqrt(r)}(this);else if("number"!=typeof r)throw new TypeError("scale must be a number");return function(t,e){for(let r=0;r<t.rows;r++)for(let n=0;n<t.columns;n++)t.set(r,n,t.get(r,n)/e)}(this,r),this;default:throw new Error(`invalid option: ${t}`)}}toString(t){return W(this,t)}}function it(t,e){return t-e}ot.prototype.klass="Matrix","undefined"!=typeof Symbol&&(ot.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return W(this)}),ot.random=ot.rand,ot.randomInt=ot.randInt,ot.diagonal=ot.diag,ot.prototype.diagonal=ot.prototype.diag,ot.identity=ot.eye,ot.prototype.negate=ot.prototype.neg,ot.prototype.tensorProduct=ot.prototype.kroneckerProduct;class st extends ot{constructor(t,e){if(super(),st.isMatrix(t))return t.clone();if(Number.isInteger(t)&&t>=0){if(this.data=[],!(Number.isInteger(e)&&e>=0))throw new TypeError("nColumns must be a positive integer");for(let r=0;r<t;r++)this.data.push(new Float64Array(e))}else{if(!Array.isArray(t))throw new TypeError("First argument must be a positive number or an array");{const r=t;if("number"!=typeof(e=(t=r.length)?r[0].length:0))throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let n=0;n<t;n++){if(r[n].length!==e)throw new RangeError("Inconsistent array dimensions");this.data.push(Float64Array.from(r[n]))}}}this.rows=t,this.columns=e}set(t,e,r){return this.data[t][e]=r,this}get(t,e){return this.data[t][e]}removeRow(t){return H(this,t),this.data.splice(t,1),this.rows-=1,this}addRow(t,e){return void 0===e&&(e=t,t=this.rows),H(this,t,!0),e=Float64Array.from(G(this,e)),this.data.splice(t,0,e),this.rows+=1,this}removeColumn(t){K(this,t);for(let e=0;e<this.rows;e++){const r=new Float64Array(this.columns-1);for(let n=0;n<t;n++)r[n]=this.data[e][n];for(let n=t+1;n<this.columns;n++)r[n-1]=this.data[e][n];this.data[e]=r}return this.columns-=1,this}addColumn(t,e){void 0===e&&(e=t,t=this.columns),K(this,t,!0),e=Z(this,e);for(let r=0;r<this.rows;r++){const n=new Float64Array(this.columns+1);let o=0;for(;o<t;o++)n[o]=this.data[r][o];for(n[o++]=e[r];o<this.columns+1;o++)n[o]=this.data[r][o-1];this.data[r]=n}return this.columns+=1,this}}!function(t,e){t.prototype.add=function(t){return"number"==typeof t?this.addS(t):this.addM(t)},t.prototype.addS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t);return this},t.prototype.addM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t.get(e,r));return this},t.add=function(t,r){return new e(t).add(r)},t.prototype.sub=function(t){return"number"==typeof t?this.subS(t):this.subM(t)},t.prototype.subS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t);return this},t.prototype.subM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t.get(e,r));return this},t.sub=function(t,r){return new e(t).sub(r)},t.prototype.subtract=t.prototype.sub,t.prototype.subtractS=t.prototype.subS,t.prototype.subtractM=t.prototype.subM,t.subtract=t.sub,t.prototype.mul=function(t){return"number"==typeof t?this.mulS(t):this.mulM(t)},t.prototype.mulS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t);return this},t.prototype.mulM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t.get(e,r));return this},t.mul=function(t,r){return new e(t).mul(r)},t.prototype.multiply=t.prototype.mul,t.prototype.multiplyS=t.prototype.mulS,t.prototype.multiplyM=t.prototype.mulM,t.multiply=t.mul,t.prototype.div=function(t){return"number"==typeof t?this.divS(t):this.divM(t)},t.prototype.divS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t);return this},t.prototype.divM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t.get(e,r));return this},t.div=function(t,r){return new e(t).div(r)},t.prototype.divide=t.prototype.div,t.prototype.divideS=t.prototype.divS,t.prototype.divideM=t.prototype.divM,t.divide=t.div,t.prototype.mod=function(t){return"number"==typeof t?this.modS(t):this.modM(t)},t.prototype.modS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)%t);return this},t.prototype.modM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)%t.get(e,r));return this},t.mod=function(t,r){return new e(t).mod(r)},t.prototype.modulus=t.prototype.mod,t.prototype.modulusS=t.prototype.modS,t.prototype.modulusM=t.prototype.modM,t.modulus=t.mod,t.prototype.and=function(t){return"number"==typeof t?this.andS(t):this.andM(t)},t.prototype.andS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)&t);return this},t.prototype.andM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)&t.get(e,r));return this},t.and=function(t,r){return new e(t).and(r)},t.prototype.or=function(t){return"number"==typeof t?this.orS(t):this.orM(t)},t.prototype.orS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)|t);return this},t.prototype.orM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)|t.get(e,r));return this},t.or=function(t,r){return new e(t).or(r)},t.prototype.xor=function(t){return"number"==typeof t?this.xorS(t):this.xorM(t)},t.prototype.xorS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)^t);return this},t.prototype.xorM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)^t.get(e,r));return this},t.xor=function(t,r){return new e(t).xor(r)},t.prototype.leftShift=function(t){return"number"==typeof t?this.leftShiftS(t):this.leftShiftM(t)},t.prototype.leftShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)<<t);return this},t.prototype.leftShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)<<t.get(e,r));return this},t.leftShift=function(t,r){return new e(t).leftShift(r)},t.prototype.signPropagatingRightShift=function(t){return"number"==typeof t?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},t.prototype.signPropagatingRightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>t);return this},t.prototype.signPropagatingRightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>t.get(e,r));return this},t.signPropagatingRightShift=function(t,r){return new e(t).signPropagatingRightShift(r)},t.prototype.rightShift=function(t){return"number"==typeof t?this.rightShiftS(t):this.rightShiftM(t)},t.prototype.rightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>>t);return this},t.prototype.rightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>>t.get(e,r));return this},t.rightShift=function(t,r){return new e(t).rightShift(r)},t.prototype.zeroFillRightShift=t.prototype.rightShift,t.prototype.zeroFillRightShiftS=t.prototype.rightShiftS,t.prototype.zeroFillRightShiftM=t.prototype.rightShiftM,t.zeroFillRightShift=t.rightShift,t.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,~this.get(t,e));return this},t.not=function(t){return new e(t).not()},t.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.abs(this.get(t,e)));return this},t.abs=function(t){return new e(t).abs()},t.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acos(this.get(t,e)));return this},t.acos=function(t){return new e(t).acos()},t.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acosh(this.get(t,e)));return this},t.acosh=function(t){return new e(t).acosh()},t.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asin(this.get(t,e)));return this},t.asin=function(t){return new e(t).asin()},t.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asinh(this.get(t,e)));return this},t.asinh=function(t){return new e(t).asinh()},t.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atan(this.get(t,e)));return this},t.atan=function(t){return new e(t).atan()},t.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atanh(this.get(t,e)));return this},t.atanh=function(t){return new e(t).atanh()},t.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cbrt(this.get(t,e)));return this},t.cbrt=function(t){return new e(t).cbrt()},t.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.ceil(this.get(t,e)));return this},t.ceil=function(t){return new e(t).ceil()},t.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.clz32(this.get(t,e)));return this},t.clz32=function(t){return new e(t).clz32()},t.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cos(this.get(t,e)));return this},t.cos=function(t){return new e(t).cos()},t.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cosh(this.get(t,e)));return this},t.cosh=function(t){return new e(t).cosh()},t.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.exp(this.get(t,e)));return this},t.exp=function(t){return new e(t).exp()},t.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.expm1(this.get(t,e)));return this},t.expm1=function(t){return new e(t).expm1()},t.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.floor(this.get(t,e)));return this},t.floor=function(t){return new e(t).floor()},t.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.fround(this.get(t,e)));return this},t.fround=function(t){return new e(t).fround()},t.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log(this.get(t,e)));return this},t.log=function(t){return new e(t).log()},t.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log1p(this.get(t,e)));return this},t.log1p=function(t){return new e(t).log1p()},t.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log10(this.get(t,e)));return this},t.log10=function(t){return new e(t).log10()},t.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log2(this.get(t,e)));return this},t.log2=function(t){return new e(t).log2()},t.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.round(this.get(t,e)));return this},t.round=function(t){return new e(t).round()},t.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sign(this.get(t,e)));return this},t.sign=function(t){return new e(t).sign()},t.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sin(this.get(t,e)));return this},t.sin=function(t){return new e(t).sin()},t.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sinh(this.get(t,e)));return this},t.sinh=function(t){return new e(t).sinh()},t.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sqrt(this.get(t,e)));return this},t.sqrt=function(t){return new e(t).sqrt()},t.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tan(this.get(t,e)));return this},t.tan=function(t){return new e(t).tan()},t.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tanh(this.get(t,e)));return this},t.tanh=function(t){return new e(t).tanh()},t.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.trunc(this.get(t,e)));return this},t.trunc=function(t){return new e(t).trunc()},t.pow=function(t,r){return new e(t).pow(r)},t.prototype.pow=function(t){return"number"==typeof t?this.powS(t):this.powM(t)},t.prototype.powS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.pow(this.get(e,r),t));return this},t.prototype.powM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.pow(this.get(e,r),t.get(e,r)));return this}}(ot,st);class at extends ot{constructor(t,e,r){super(),this.matrix=t,this.rows=e,this.columns=r}}class lt extends at{constructor(t){super(t,t.columns,t.rows)}set(t,e,r){return this.matrix.set(e,t,r),this}get(t,e){return this.matrix.get(e,t)}}class ut extends ot{constructor(t){super(),this.data=t,this.rows=t.length,this.columns=t[0].length}set(t,e,r){return this.data[t][e]=r,this}get(t,e){return this.data[t][e]}}class ht{constructor(t){let e,r,n,o,i,s,a,l,u,h=(t=ut.checkMatrix(t)).clone(),c=h.rows,f=h.columns,m=new Float64Array(c),p=1;for(e=0;e<c;e++)m[e]=e;for(l=new Float64Array(c),r=0;r<f;r++){for(e=0;e<c;e++)l[e]=h.get(e,r);for(e=0;e<c;e++){for(u=Math.min(e,r),i=0,n=0;n<u;n++)i+=h.get(e,n)*l[n];l[e]-=i,h.set(e,r,l[e])}for(o=r,e=r+1;e<c;e++)Math.abs(l[e])>Math.abs(l[o])&&(o=e);if(o!==r){for(n=0;n<f;n++)s=h.get(o,n),h.set(o,n,h.get(r,n)),h.set(r,n,s);a=m[o],m[o]=m[r],m[r]=a,p=-p}if(r<c&&0!==h.get(r,r))for(e=r+1;e<c;e++)h.set(e,r,h.get(e,r)/h.get(r,r))}this.LU=h,this.pivotVector=m,this.pivotSign=p}isSingular(){let t=this.LU,e=t.columns;for(let r=0;r<e;r++)if(0===t.get(r,r))return!0;return!1}solve(t){t=st.checkMatrix(t);let e=this.LU;if(e.rows!==t.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let r,n,o,i=t.columns,s=t.subMatrixRow(this.pivotVector,0,i-1),a=e.columns;for(o=0;o<a;o++)for(r=o+1;r<a;r++)for(n=0;n<i;n++)s.set(r,n,s.get(r,n)-s.get(o,n)*e.get(r,o));for(o=a-1;o>=0;o--){for(n=0;n<i;n++)s.set(o,n,s.get(o,n)/e.get(o,o));for(r=0;r<o;r++)for(n=0;n<i;n++)s.set(r,n,s.get(r,n)-s.get(o,n)*e.get(r,o))}return s}get determinant(){let t=this.LU;if(!t.isSquare())throw new Error("Matrix must be square");let e=this.pivotSign,r=t.columns;for(let n=0;n<r;n++)e*=t.get(n,n);return e}get lowerTriangularMatrix(){let t=this.LU,e=t.rows,r=t.columns,n=new st(e,r);for(let o=0;o<e;o++)for(let e=0;e<r;e++)o>e?n.set(o,e,t.get(o,e)):o===e?n.set(o,e,1):n.set(o,e,0);return n}get upperTriangularMatrix(){let t=this.LU,e=t.rows,r=t.columns,n=new st(e,r);for(let o=0;o<e;o++)for(let e=0;e<r;e++)o<=e?n.set(o,e,t.get(o,e)):n.set(o,e,0);return n}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function ct(t,e){let r=0;return Math.abs(t)>Math.abs(e)?(r=e/t,Math.abs(t)*Math.sqrt(1+r*r)):0!==e?(r=t/e,Math.abs(e)*Math.sqrt(1+r*r)):0}class ft{constructor(t){let e,r,n,o,i=(t=ut.checkMatrix(t)).clone(),s=t.rows,a=t.columns,l=new Float64Array(a);for(n=0;n<a;n++){let t=0;for(e=n;e<s;e++)t=ct(t,i.get(e,n));if(0!==t){for(i.get(n,n)<0&&(t=-t),e=n;e<s;e++)i.set(e,n,i.get(e,n)/t);for(i.set(n,n,i.get(n,n)+1),r=n+1;r<a;r++){for(o=0,e=n;e<s;e++)o+=i.get(e,n)*i.get(e,r);for(o=-o/i.get(n,n),e=n;e<s;e++)i.set(e,r,i.get(e,r)+o*i.get(e,n))}}l[n]=-t}this.QR=i,this.Rdiag=l}solve(t){t=st.checkMatrix(t);let e=this.QR,r=e.rows;if(t.rows!==r)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let n,o,i,s,a=t.columns,l=t.clone(),u=e.columns;for(i=0;i<u;i++)for(o=0;o<a;o++){for(s=0,n=i;n<r;n++)s+=e.get(n,i)*l.get(n,o);for(s=-s/e.get(i,i),n=i;n<r;n++)l.set(n,o,l.get(n,o)+s*e.get(n,i))}for(i=u-1;i>=0;i--){for(o=0;o<a;o++)l.set(i,o,l.get(i,o)/this.Rdiag[i]);for(n=0;n<i;n++)for(o=0;o<a;o++)l.set(n,o,l.get(n,o)-l.get(i,o)*e.get(n,i))}return l.subMatrix(0,u-1,0,a-1)}isFullRank(){let t=this.QR.columns;for(let e=0;e<t;e++)if(0===this.Rdiag[e])return!1;return!0}get upperTriangularMatrix(){let t,e,r=this.QR,n=r.columns,o=new st(n,n);for(t=0;t<n;t++)for(e=0;e<n;e++)t<e?o.set(t,e,r.get(t,e)):t===e?o.set(t,e,this.Rdiag[t]):o.set(t,e,0);return o}get orthogonalMatrix(){let t,e,r,n,o=this.QR,i=o.rows,s=o.columns,a=new st(i,s);for(r=s-1;r>=0;r--){for(t=0;t<i;t++)a.set(t,r,0);for(a.set(r,r,1),e=r;e<s;e++)if(0!==o.get(r,r)){for(n=0,t=r;t<i;t++)n+=o.get(t,r)*a.get(t,e);for(n=-n/o.get(r,r),t=r;t<i;t++)a.set(t,e,a.get(t,e)+n*o.get(t,r))}}return a}}class mt{constructor(t,e={}){if((t=ut.checkMatrix(t)).isEmpty())throw new Error("Matrix must be non-empty");let r=t.rows,n=t.columns;const{computeLeftSingularVectors:o=!0,computeRightSingularVectors:i=!0,autoTranspose:s=!1}=e;let a,l=Boolean(o),u=Boolean(i),h=!1;if(r<n)if(s){a=t.transpose(),r=a.rows,n=a.columns,h=!0;let e=l;l=u,u=e}else a=t.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else a=t.clone();let c=Math.min(r,n),f=Math.min(r+1,n),m=new Float64Array(f),p=new st(r,c),g=new st(n,n),d=new Float64Array(n),w=new Float64Array(r),y=new Float64Array(f);for(let t=0;t<f;t++)y[t]=t;let b=Math.min(r-1,n),v=Math.max(0,Math.min(n-2,r)),x=Math.max(b,v);for(let t=0;t<x;t++){if(t<b){m[t]=0;for(let e=t;e<r;e++)m[t]=ct(m[t],a.get(e,t));if(0!==m[t]){a.get(t,t)<0&&(m[t]=-m[t]);for(let e=t;e<r;e++)a.set(e,t,a.get(e,t)/m[t]);a.set(t,t,a.get(t,t)+1)}m[t]=-m[t]}for(let e=t+1;e<n;e++){if(t<b&&0!==m[t]){let n=0;for(let o=t;o<r;o++)n+=a.get(o,t)*a.get(o,e);n=-n/a.get(t,t);for(let o=t;o<r;o++)a.set(o,e,a.get(o,e)+n*a.get(o,t))}d[e]=a.get(t,e)}if(l&&t<b)for(let e=t;e<r;e++)p.set(e,t,a.get(e,t));if(t<v){d[t]=0;for(let e=t+1;e<n;e++)d[t]=ct(d[t],d[e]);if(0!==d[t]){d[t+1]<0&&(d[t]=0-d[t]);for(let e=t+1;e<n;e++)d[e]/=d[t];d[t+1]+=1}if(d[t]=-d[t],t+1<r&&0!==d[t]){for(let e=t+1;e<r;e++)w[e]=0;for(let e=t+1;e<r;e++)for(let r=t+1;r<n;r++)w[e]+=d[r]*a.get(e,r);for(let e=t+1;e<n;e++){let n=-d[e]/d[t+1];for(let o=t+1;o<r;o++)a.set(o,e,a.get(o,e)+n*w[o])}}if(u)for(let e=t+1;e<n;e++)g.set(e,t,d[e])}}let M=Math.min(n,r+1);if(b<n&&(m[b]=a.get(b,b)),r<M&&(m[M-1]=0),v+1<M&&(d[v]=a.get(v,M-1)),d[M-1]=0,l){for(let t=b;t<c;t++){for(let e=0;e<r;e++)p.set(e,t,0);p.set(t,t,1)}for(let t=b-1;t>=0;t--)if(0!==m[t]){for(let e=t+1;e<c;e++){let n=0;for(let o=t;o<r;o++)n+=p.get(o,t)*p.get(o,e);n=-n/p.get(t,t);for(let o=t;o<r;o++)p.set(o,e,p.get(o,e)+n*p.get(o,t))}for(let e=t;e<r;e++)p.set(e,t,-p.get(e,t));p.set(t,t,1+p.get(t,t));for(let e=0;e<t-1;e++)p.set(e,t,0)}else{for(let e=0;e<r;e++)p.set(e,t,0);p.set(t,t,1)}}if(u)for(let t=n-1;t>=0;t--){if(t<v&&0!==d[t])for(let e=t+1;e<n;e++){let r=0;for(let o=t+1;o<n;o++)r+=g.get(o,t)*g.get(o,e);r=-r/g.get(t+1,t);for(let o=t+1;o<n;o++)g.set(o,e,g.get(o,e)+r*g.get(o,t))}for(let e=0;e<n;e++)g.set(e,t,0);g.set(t,t,1)}let E=M-1,A=Number.EPSILON;for(;M>0;){let t,e;for(t=M-2;t>=-1&&-1!==t;t--){const e=Number.MIN_VALUE+A*Math.abs(m[t]+Math.abs(m[t+1]));if(Math.abs(d[t])<=e||Number.isNaN(d[t])){d[t]=0;break}}if(t===M-2)e=4;else{let r;for(r=M-1;r>=t&&r!==t;r--){let e=(r!==M?Math.abs(d[r]):0)+(r!==t+1?Math.abs(d[r-1]):0);if(Math.abs(m[r])<=A*e){m[r]=0;break}}r===t?e=3:r===M-1?e=1:(e=2,t=r)}switch(t++,e){case 1:{let e=d[M-2];d[M-2]=0;for(let r=M-2;r>=t;r--){let o=ct(m[r],e),i=m[r]/o,s=e/o;if(m[r]=o,r!==t&&(e=-s*d[r-1],d[r-1]=i*d[r-1]),u)for(let t=0;t<n;t++)o=i*g.get(t,r)+s*g.get(t,M-1),g.set(t,M-1,-s*g.get(t,r)+i*g.get(t,M-1)),g.set(t,r,o)}break}case 2:{let e=d[t-1];d[t-1]=0;for(let n=t;n<M;n++){let o=ct(m[n],e),i=m[n]/o,s=e/o;if(m[n]=o,e=-s*d[n],d[n]=i*d[n],l)for(let e=0;e<r;e++)o=i*p.get(e,n)+s*p.get(e,t-1),p.set(e,t-1,-s*p.get(e,n)+i*p.get(e,t-1)),p.set(e,n,o)}break}case 3:{const e=Math.max(Math.abs(m[M-1]),Math.abs(m[M-2]),Math.abs(d[M-2]),Math.abs(m[t]),Math.abs(d[t])),o=m[M-1]/e,i=m[M-2]/e,s=d[M-2]/e,a=m[t]/e,h=d[t]/e,c=((i+o)*(i-o)+s*s)/2,f=o*s*(o*s);let w=0;0===c&&0===f||(w=c<0?0-Math.sqrt(c*c+f):Math.sqrt(c*c+f),w=f/(c+w));let y=(a+o)*(a-o)+w,b=a*h;for(let e=t;e<M-1;e++){let o=ct(y,b);0===o&&(o=Number.MIN_VALUE);let i=y/o,s=b/o;if(e!==t&&(d[e-1]=o),y=i*m[e]+s*d[e],d[e]=i*d[e]-s*m[e],b=s*m[e+1],m[e+1]=i*m[e+1],u)for(let t=0;t<n;t++)o=i*g.get(t,e)+s*g.get(t,e+1),g.set(t,e+1,-s*g.get(t,e)+i*g.get(t,e+1)),g.set(t,e,o);if(o=ct(y,b),0===o&&(o=Number.MIN_VALUE),i=y/o,s=b/o,m[e]=o,y=i*d[e]+s*m[e+1],m[e+1]=-s*d[e]+i*m[e+1],b=s*d[e+1],d[e+1]=i*d[e+1],l&&e<r-1)for(let t=0;t<r;t++)o=i*p.get(t,e)+s*p.get(t,e+1),p.set(t,e+1,-s*p.get(t,e)+i*p.get(t,e+1)),p.set(t,e,o)}d[M-2]=y;break}case 4:if(m[t]<=0&&(m[t]=m[t]<0?-m[t]:0,u))for(let e=0;e<=E;e++)g.set(e,t,-g.get(e,t));for(;t<E&&!(m[t]>=m[t+1]);){let e=m[t];if(m[t]=m[t+1],m[t+1]=e,u&&t<n-1)for(let r=0;r<n;r++)e=g.get(r,t+1),g.set(r,t+1,g.get(r,t)),g.set(r,t,e);if(l&&t<r-1)for(let n=0;n<r;n++)e=p.get(n,t+1),p.set(n,t+1,p.get(n,t)),p.set(n,t,e);t++}M--}}if(h){let t=g;g=p,p=t}this.m=r,this.n=n,this.s=m,this.U=p,this.V=g}solve(t){let e=t,r=this.threshold,n=this.s.length,o=st.zeros(n,n);for(let t=0;t<n;t++)Math.abs(this.s[t])<=r?o.set(t,t,0):o.set(t,t,1/this.s[t]);let i=this.U,s=this.rightSingularVectors,a=s.mmul(o),l=s.rows,u=i.rows,h=st.zeros(l,u);for(let t=0;t<l;t++)for(let e=0;e<u;e++){let r=0;for(let o=0;o<n;o++)r+=a.get(t,o)*i.get(e,o);h.set(t,e,r)}return h.mmul(e)}solveForDiagonal(t){return this.solve(st.diag(t))}inverse(){let t=this.V,e=this.threshold,r=t.rows,n=t.columns,o=new st(r,this.s.length);for(let i=0;i<r;i++)for(let r=0;r<n;r++)Math.abs(this.s[r])>e&&o.set(i,r,t.get(i,r)/this.s[r]);let i=this.U,s=i.rows,a=i.columns,l=new st(r,s);for(let t=0;t<r;t++)for(let e=0;e<s;e++){let r=0;for(let n=0;n<a;n++)r+=o.get(t,n)*i.get(e,n);l.set(t,e,r)}return l}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let t=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,e=0,r=this.s;for(let n=0,o=r.length;n<o;n++)r[n]>t&&e++;return e}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return st.diag(this.s)}}function pt(t,e,r=!1){return t=ut.checkMatrix(t),e=ut.checkMatrix(e),r?new mt(t).solve(e):t.isSquare()?new ht(t).solve(e):new ft(t).solve(e)}function gt(t,e,r={}){let{color:n="#A9A9A9",opacity:o=1,lineWidth:i=1}=r;n=n.match(/#[0-9A-F]{6}$/i)?(n+(255*o>>0).toString(16)).toUpperCase():n.replace(/rgb ?\((.*)\)/,`rgba($1,${o})`),t.style=[{name:"unselected",style:{line:{color:n,width:i,dash:1}}},{name:"selected",style:{line:{color:n,width:i+2,dash:1}}}],t.name=e.label||e.id}const dt=["#FFB300","#803E75","#FF6800","#A6BDD7","#C10020","#CEA262","#817066","#007D34","#F6768E","#00538A","#FF7A5C","#53377A","#FF8E00","#B32851","#F4C800","#7F180D","#93AA00","#593315","#F13A13","#232C16"];function wt(t,e,r){t[e]||(t[e]={key:e,values:[],count:0}),t[e].values.includes(r)||t[e].values.push(r),t[e].count++}function yt(t,e){t[e]||(t[e]={key:e,count:0}),t[e].count++}function bt(t,e,r){if(r){let n=new Array(e);for(let t=0;t<e;t++)n[r[t]]=t;let o=[];for(let e=0;e<t.length;++e){let r=n[t[e][0]],i=n[t[e][1]];if(i<r){let t=i;i=r,r=t}o[e]=[],o[e][0]=r,o[e][1]=i,o[e][2]=t[e][2]}t=o}else{r=[];for(let t=0;t<e;++t)r[t]=t}let n=new Array(e+1),o=new Array(t.length),i=new Array(t.length),s=[];for(let t=0;t<e;++t)s[t]=0;for(let e=0;e<t.length;++e)s[t[e][1]]++;n[0]=0;for(let t=0;t<e;++t)n[t+1]=n[t]+s[t];let a=[];for(let t=0;t<e;++t)a[t]=0;for(let e=0;e<t.length;++e){let r=t[e],s=r[1],l=n[s]+a[s];o[l]=r[0],i[l]=r[2],a[s]++}let l,u=new Array(e),h=new Array(e),c=new Array(e+1),f=new Array(e),m=new Array(e),p=new Array(e),g=new Array(e),d=new Array(e),w=new Array(e);!function(t,e,r,n,o,i,s){let a,l,u,h,c;for(l=0;l<t;l++)for(o[l]=-1,s[l]=l,i[l]=0,h=l,c=e[h+1],u=e[h];u<c;u++)if(a=r[u],a<l)for(;s[a]!==l;a=o[a])-1===o[a]&&(o[a]=l),i[a]++,s[a]=l;for(n[0]=0,l=0;l<t;l++)n[l+1]=n[l]+i[l]}(e,n,o,c,f,m,p);let y=new Array(c[e]),b=new Array(c[e]);return l=function(t,e,r,n,o,i,s,a,l,u,h,c,f){let m,p,g,d,w,y,b,v,x;for(d=0;d<t;d++){for(h[d]=0,x=t,f[d]=d,s[d]=0,y=d,b=e[y+1],w=e[y];w<b;w++)if(g=r[w],g<=d){for(h[g]+=n[w],v=0;f[g]!==d;g=i[g])c[v++]=g,f[g]=d;for(;v>0;)c[--x]=c[--v]}for(u[d]=h[d],h[d]=0;x<t;x++){for(g=c[x],m=h[g],h[g]=0,b=o[g]+s[g],w=o[g];w<b;w++)h[a[w]]-=l[w]*m;p=m/u[g],u[d]-=p*m,a[w]=d,l[w]=p,s[g]++}if(0===u[d])return d}return t}(e,n,o,i,c,f,m,b,y,u,h,g,p),l===e?function(t){return function(t,e,r,n){let o;for(o=0;o<t;o++)e[o]=r[n[o]]}(e,d,t,r),function(t,e,r,n,o){let i,s,a;for(i=0;i<t;i++)for(a=r[i+1],s=r[i];s<a;s++)e[n[s]]-=o[s]*e[i]}(e,d,c,b,y),function(t,e,r){let n;for(n=0;n<t;n++)e[n]/=r[n]}(e,d,u),function(t,e,r,n,o){let i,s,a;for(i=t-1;i>=0;i--)for(a=r[i+1],s=r[i];s<a;s++)e[i]-=o[s]*e[n[s]]}(e,d,c,b,y),function(t,e,r,n){let o;for(o=0;o<t;o++)e[n[o]]=r[o]}(e,w,d,r),w}:null}var vt=function(t,e){for(var r=new Array(e),n=new Array(e),o=0;o<e;++o)r[o]=[],n[o]=!1;for(o=0;o<t.length;++o){var i=t[o];r[i[0]].push(i[1])}var s=new Array(e),a=0,l=0;for(o=0;o<e;++o)if(!n[o])for(s[a++]=o,n[o]=!0;l<a;){var u=s[l++],h=r[u];h.sort(xt);for(var c=0;c<h.length;++c){var f=h[c];n[f]||(n[f]=!0,s[a++]=f)}}var m=new Array(e);for(o=0;o<e;++o)m[s[o]]=o;return m};function xt(t,e){return t-e}const Mt=(t=[],e=0)=>{const r=((t=[],e=0)=>t.reduce(((t,r)=>Math.abs(r-e)<Math.abs(t-e)?r:t)))(t,e);return t.indexOf(r)},Et=(t,e,r)=>{let n=e.length,o=n-1,i=new Array(t.length),s=new Float64Array(n);for(let n=0;n<o;n++){let o=r[n],a=2*n,l=a+1;i[a]=t[a].slice(),i[l]=t[l].slice(),0===o?s[n]=0:(s[n]=e[n]*o,i[a][2]+=o)}return s[o]=e[o]*r[o],i[2*o]=t[2*o].slice(),i[2*o][2]+=r[o],[i,s]};function At(t,e,r={}){let n,o,{maxIterations:i=100,lambda:s=100,factorCriterion:a=.001,weights:l=new Array(e.length).fill(1),controlPoints:u=[],baseLineZones:h=[]}=r;u.length>0&&u.forEach(((e,r,n)=>n[r]=Mt(t,e))),h.length>0&&h.forEach((e=>{let r=Mt(t,e.from),n=Mt(t,e.to);r>n&&([r,n]=[n,r]);for(let t=r;t<n;t++)u.push(t)}));let c=e.length,f=c-1,m=Number.MAX_SAFE_INTEGER,p=a*e.reduce(((t,e)=>Math.abs(e)+t),0),{lowerTriangularNonZeros:g,permutationEncodedArray:d}=((t,e)=>{let r=[],n=t-1;for(let t=0;t<n;t++)r.push([t,t,2*e]),r.push([t+1,t,-1*e]);return r[0][2]=e,r.push([n,n,e]),{lowerTriangularNonZeros:r,permutationEncodedArray:vt(r,t)}})(c,s);for(o=0;o<i&&Math.abs(m)>p;o++){let[t,r]=Et(g,e,l),i=bt(t,c,d);n=i(r),m=0;let s=e.map(w),a=-1*Number.MAX_SAFE_INTEGER;for(let t=1;t<f;t++){let e=s[t];e>=0?l[t]=0:(l[t]=Math.exp(o*e/m),a<e&&(a=e))}let h=Math.exp(o*a/m);l[0]=h,l[f]=h,u.forEach((t=>l[t]=h))}return{corrected:e.map(((t,e)=>t-n[e])),baseline:n,iteration:o,error:m};function w(t,e){let r=t-n[e];return r<0&&(m+=r),r}}function St(t,e={}){const r=t.length;let{x:n,regressionOptions:o}=e;n||(n=c({from:0,to:r-1,size:r}));let i=At(n,t,o);return{baseline:i.baseline,correctedSpectrum:i.corrected}}function Tt(t,e){return t<0?(t=0-t,"number"==typeof e?`- ${t.toPrecision(e)}`:`- ${t.toString()}`):"number"==typeof e?t.toPrecision(e):t.toString()}class kt{constructor(){if(new.target===kt)throw new Error("BaseRegression must be subclassed")}predict(t){if("number"==typeof t)return this._predict(t);if(r(t)){const e=[];for(let r=0;r<t.length;r++)e.push(this._predict(t[r]));return e}throw new TypeError("x must be a number or array")}_predict(){throw new Error("_predict must be implemented")}train(){}toString(){return""}toLaTeX(){return""}score(t,e){if(!r(t)||!r(e)||t.length!==e.length)throw new Error("x and y must be arrays of the same length");const n=t.length,o=new Array(n);for(let e=0;e<n;e++)o[e]=this._predict(t[e]);let i=0,s=0,a=0,l=0,u=0,h=0,c=0;for(let t=0;t<n;t++)i+=o[t],s+=e[t],u+=o[t]*o[t],h+=e[t]*e[t],c+=o[t]*e[t],0!==e[t]&&(a+=(e[t]-o[t])*(e[t]-o[t])/e[t]),l+=(e[t]-o[t])*(e[t]-o[t]);const f=(n*c-i*s)/Math.sqrt((n*u-i*i)*(n*h-s*s));return{r:f,r2:f*f,chi2:a,rmsd:Math.sqrt(l/n)}}}class Ft extends kt{constructor(t,e,n){super(),!0===t?(this.degree=e.degree,this.powers=e.powers,this.coefficients=e.coefficients):(function(t,e){if(!r(t)||!r(e))throw new TypeError("x and y must be arrays");if(t.length!==e.length)throw new RangeError("x and y arrays must have the same length")}(t,e),function(t,e,r,n){const o=e.length;let i;if(Array.isArray(n))i=n,n=i.length;else{n++,i=new Array(n);for(let t=0;t<n;t++)i[t]=t}const s=new st(o,n),a=new st([r]);for(let t=0;t<n;t++)for(let r=0;r<o;r++)0===i[t]?s.set(r,t,1):s.set(r,t,Math.pow(e[r],i[t]));const l=new lt(s),u=l.mmul(s),h=l.mmul(new lt(a));t.degree=n-1,t.powers=i,t.coefficients=pt(u,h).to1DArray()}(this,t,e,n))}_predict(t){let e=0;for(let r=0;r<this.powers.length;r++)e+=this.coefficients[r]*Math.pow(t,this.powers[r]);return e}toJSON(){return{name:"polynomialRegression",degree:this.degree,powers:this.powers,coefficients:this.coefficients}}toString(t){return this._toFormula(t,!1)}toLaTeX(t){return this._toFormula(t,!0)}_toFormula(t,e){let r="^",n="",o=" * ";e&&(r="^{",n="}",o="");let i="",s="";for(let e=0;e<this.coefficients.length;e++)s="",0!==this.coefficients[e]&&(s=0===this.powers[e]?Tt(this.coefficients[e],t):1===this.powers[e]?`${Tt(this.coefficients[e],t)+o}x`:`${Tt(this.coefficients[e],t)+o}x${r}${this.powers[e]}${n}`,this.coefficients[e]>0&&e!==this.coefficients.length-1?s=` + ${s}`:e!==this.coefficients.length-1&&(s=` ${s}`)),i=s+i;return"+"===i.charAt(0)&&(i=i.slice(1)),`f(x) = ${i}`}static load(t){if("polynomialRegression"!==t.name)throw new TypeError("not a polynomial regression model");return new Ft(!0,t)}}function Nt(t,e={}){const r=t.length;let{x:n,regressionOptions:o}=e;n||(n=c({from:0,to:r-1,size:r}));let i=function(t,e,r={}){let{maxIterations:n=100,Regression:o=Ft,regressionOptions:i,tolerance:s=.001}=r;i||o!==Ft||(i=3);let a,l,u=e.slice(),h=e.slice(),c=e,f=0;for(;f<n;){l=new o(t,u,i),a=0;for(let e=0;e<u.length;e++)h[e]=l.predict(t[e]),u[e]>h[e]&&(u[e]=h[e]),a+=Math.abs((h[e]-c[e])/c[e]);if(a<s)break;c=h.slice(),f++}let m=new Array(u.length);for(let t=0;t<u.length;t++)m[t]=e[t]-u[t];return{corrected:m,delta:a,iteration:f,baseline:u,regression:l}}(n,t,o);return{baseline:i.baseline,correctedSpectrum:i.corrected}}function Rt(t){if(!r(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty")}function zt(t,e,r={}){if(Rt(t),"function"!=typeof e)throw Error("fct has to be a function");const{window:n=5,padding:o={}}=r,{size:i=n-1,algorithm:s,value:a}=o;t=function(t,e={}){const{size:r=0,value:n=0,algorithm:o=""}=e;if(Rt(t),!o)return t instanceof Float64Array?t.slice():Float64Array.from(t);let i=new Float64Array(t.length+2*r);for(let e=0;e<t.length;e++)i[e+r]=t[e];let s=r+t.length,a=2*r+t.length;switch(o.toLowerCase()){case"value":for(let t=0;t<r;t++)i[t]=n;for(let t=s;t<a;t++)i[t]=n;break;case"duplicate":for(let e=0;e<r;e++)i[e]=t[0];for(let e=s;e<a;e++)i[e]=t[t.length-1];break;case"circular":for(let e=0;e<r;e++)i[e]=t[(t.length-r%t.length+e)%t.length];for(let e=0;e<r;e++)i[e+s]=t[e%t.length];break;default:throw Error("xPadding: unknown algorithm")}return i}(t,{size:i,algorithm:s,value:a});const l=[];for(let r=0;r<t.length-n+1;r++){let o=new Float64Array(t.buffer,8*r,n);l.push(e(o))}return l}function Ct(t,e={}){let r=Math.max(Math.round(.1*t.length),2),n={window:r,padding:{size:r-1,algorithm:"duplicate",value:0}},o=function(t,e={}){return zt(t,p,e)}(t,Object.assign({},n,e)),i=new Float64Array(t.length);for(let e=0;e<i.length;e++)i[e]=t[e]-o[e];return{baseline:o,correctedSpectrum:i}}function It(t,e={}){const n=function(t,e={}){if(!r(t))throw new Error("Spectrum must be an array");if(0===t.length)throw new TypeError("Spectrum must not be empty");const n=t.length,o=new Float64Array(n),i=new Float64Array(n),s=new Float64Array(n),{windowM:a=Math.round(.04*n),windowS:l=Math.round(.08*n)}=e;for(let e=0;e<t.length;e++){let r=d([0,e-a]),n=g([e+a+1,t.length]);i[e]=g(t.slice(r,n))}for(let t=0;t<i.length;t++){let e=d([0,t-a]),r=g([t+a+1,i.length]);o[t]=d(i.slice(e,r))}for(let t=0;t<i.length;t++){let e=d([0,t-l]),r=g([t+l+1,o.length]);s[t]=p(o.slice(e,r))}return s}(t,e);let o=new Float64Array(t.length);for(let e=0;e<o.length;e++)o[e]=t[e]-n[e];return{baseline:n,correctedSpectrum:o}}function $t(t,e={}){let r=Math.max(Math.round(.1*t.length),2),n={window:r,padding:{size:r-1,algorithm:"duplicate",value:0}},o=function(t,e={}){return zt(t,i,e)}(t,Object.assign({},n,e)),s=new Float64Array(t.length);for(let e=0;e<s.length;e++)s[e]=t[e]-o[e];return{baseline:o,correctedSpectrum:s}}function Ot(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=n.algorithm,i=void 0===o?"absolute":o,s=n.sumValue,a=void 0===s?1:s,l=n.maxValue,u=void 0===l?1:l;if(!r(t))throw new Error("input must be an array");if(void 0!==n.output){if(!r(n.output))throw new TypeError("output option must be an array if specified");e=n.output}else e=new Array(t.length);if(0===t.length)throw new Error("input must not be empty");switch(i.toLowerCase()){case"absolute":var h=Pt(t)/a;if(0===h)return t.slice(0);for(var c=0;c<t.length;c++)e[c]=t[c]/h;return e;case"max":var f=d(t);if(0===f)return t.slice(0);for(var p=u/f,g=0;g<t.length;g++)e[g]=t[g]*p;return e;case"sum":var w=m(t)/a;if(0===w)return t.slice(0);for(var y=0;y<t.length;y++)e[y]=t[y]/w;return e;default:throw new Error("norm: unknown algorithm: ".concat(i))}}function Pt(t){for(var e=0,r=0;r<t.length;r++)e+=Math.abs(t[r]);return e}function Ut(t=[],e={}){if(0===t.length)return[];let{from:r=Number.NEGATIVE_INFINITY,to:n=Number.POSITIVE_INFINITY}=e;if(r>n&&([r,n]=[n,r]),(t=(t=JSON.parse(JSON.stringify(t)).map((t=>t.from>t.to?{from:t.to,to:t.from}:t))).sort(((t,e)=>t.from!==e.from?t.from-e.from:t.to-e.to))).forEach((t=>{r>t.from&&(t.from=r),n<t.to&&(t.to=n)})),0===(t=t.filter((t=>t.from<=t.to))).length)return[];let o=t[0],i=[o];for(let e=1;e<t.length;e++){let r=t[e];r.from<=o.to?o.to=r.to:(o=r,i.push(o))}return i}function Vt(t,e,r,n){return.5*r*e*e+n*e-(.5*r*t*t+n*t)}function Dt(t={},e={}){let{x:r,y:n}=t,o=r.length,i=!1;r.length>1&&r[0]>r[1]&&(r=r.slice().reverse(),n=n.slice().reverse(),i=!0);let{from:s=r[0],to:a=r[o-1],variant:l="smooth",numberOfPoints:u=100,exclusions:h=[],zones:c=[]}=e;if(o!==n.length)throw new RangeError("the x and y vector doesn't have the same size.");if("number"!=typeof s||isNaN(s))throw new RangeError("'from' option must be a number");if("number"!=typeof a||isNaN(a))throw new RangeError("'to' option must be a number");if("number"!=typeof u||isNaN(u))throw new RangeError("'numberOfPoints' option must be a number");if(u<2)throw new RangeError("'numberOfPoints' option must be greater than 1");0===c.length&&(c=function(t=[],e={}){let{from:r=Number.NEGATIVE_INFINITY,to:n=Number.POSITIVE_INFINITY}=e;if(r>n&&([r,n]=[n,r]),0===(t=Ut(t,{from:r,to:n})).length)return[{from:r,to:n}];let o=[];for(let e=0;e<t.length;e++){let i=t[e],s=t[e+1];0===e&&i.from>r&&o.push({from:r,to:i.from}),e===t.length-1?i.to<n&&o.push({from:i.to,to:n}):o.push({from:i.to,to:s.from})}return o}(h,{from:s,to:a})),c=function(t,e,r={}){if(0===t.length)return t;let n=(t=Ut(t,r)).reduce(((t,e)=>t+(e.to-e.from)),0)/e,o=0;for(let r=0;r<t.length-1;r++){let i=t[r];i.numberOfPoints=Math.min(Math.round((i.to-i.from)/n),e-o),o+=i.numberOfPoints}return t[t.length-1].numberOfPoints=e-o,t}(c,u,{from:s,to:a});let f=[],m=[];for(let t of c){let e=Lt(r,n,t.from,t.to,t.numberOfPoints,l);f=f.concat(e.x),m=m.concat(e.y)}return i?s<a?{x:f.reverse(),y:m.reverse()}:{x:f,y:m}:s<a?{x:f,y:m}:{x:f.reverse(),y:m.reverse()}}function Lt(t,e,r,n,o,i){if(o<1)throw new RangeError("the number of points must be at least 1");let s="slot"===i?function(t,e,r,n,o){let i=t.length,s=(n-r)/(o>1?o-1:1),a=s/2,l=t[t.length-1]-t[t.length-2],u=r-a,h=new Array(o),c=u,f=u+s,m=-Number.MAX_VALUE,p=0,g=t[0],d=e[0],w=0,y=!0,b=0,v=0,x=1,M=0;t:for(;;){if(m>=g)throw new Error("x must be an increasing serie");for(;m-f>0;){if(y&&(v++,y=!1),h[M]=v<=0?0:b/v,M++,M===o)break t;c=f,f+=s,b=0,v=0}m>c&&(b+=p,v++),(m===-Number.MAX_VALUE||w>1)&&v--,m=g,p=d,x<i?(g=t[x],d=e[x],x++):(g+=l,d=0,w++)}return h}(t,e,r,n,o):function(t,e,r,n,o){let i=t.length,s=(n-r)/(o>1?o-1:1),a=s/2,l=new Array(o),u=t[1]-t[0],h=t[i-1]-t[i-2],c=r-a,f=r+a,m=Number.MIN_VALUE,p=0,g=t[0]-u,d=0,w=0,y=0,b=0,v=0,x=0,M=0,E=0,A=0;t:for(;;){for(m<=c&&c<=g&&(A=Vt(0,c-m,y,p),v=w+A);g-f>=0;){if(A=Vt(0,f-m,y,p),x=w+A,l[E++]=(x-v)/s,E===o)break t;c=f,f+=s,v=x}w+=Vt(m,g,y,b),m=g,p=d,M<i?(g=t[M],d=e[M],M++):M===i&&(g+=h,d=0),y=(d-p)/(g-m),b=-y*m+p}return l}(t,e,r,n,o);return{x:c({from:r,to:n,size:o}),y:s}}function Xt(t,e={}){const{x:r,y:n}=t,{from:o=r[0],to:i=r[r.length-1],exclusions:s=[]}=e;let a=function(t,e,r=[]){t>e&&([t,e]=[e,t]),r=r.filter((t=>void 0!==t.from&&void 0!==t.to)),(r=JSON.parse(JSON.stringify(r))).forEach((t=>{t.from>t.to&&([t.to,t.from]=[t.from,t.to])})),r.sort(((t,e)=>t.from-e.from)),r.forEach((r=>{r.from<t&&(r.from=t),r.to>e&&(r.to=e)}));for(let t=0;t<r.length-1;t++)r[t].to>r[t+1].from&&(r[t].to=r[t+1].from);if(!(r=r.filter((t=>t.from<t.to)))||0===r.length)return[{from:t,to:e}];let n=[],o=t;for(let t of r)o<t.from&&n.push({from:o,to:t.from}),o=t.to;return o<e&&n.push({from:o,to:e}),n}(o,i,s),l=0,u=[],h=[],c=0;for(;c<r.length;){if(r[c]<=a[l].to&&r[c]>=a[l].from)u.push(r[c]),h.push(n[c]);else if(r[c]>a[l].to&&(l++,!a[l]))break;c++}return{x:u,y:h}}var qt={size:1,value:0};var _t=function(t,e){if(e=Object.assign({},qt,e),Array.isArray(t))return Array.isArray(t[0])?function(t,e){throw void 0===e.size[0]&&(e.size=[e.size,e.size,e.size,e.size]),new Error("matrix not supported yet, sorry")}(0,e):function(t,e){var r=t.length;"number"==typeof e.size&&(e.size=[e.size,e.size]);var n,o,i=r+e.size[0]+e.size[1];if(e.output){if(e.output.length!==i)throw new RangeError("Wrong output size");n=e.output}else n=new Array(i);if("circular"===e.value)for(o=0;o<i;o++)o<e.size[0]?n[o]=t[(r-e.size[0]%r+o)%r]:o<e.size[0]+r?n[o]=t[o-e.size[0]]:n[o]=t[(o-e.size[0])%r];else if("replicate"===e.value)for(o=0;o<i;o++)o<e.size[0]?n[o]=t[0]:o<e.size[0]+r?n[o]=t[o-e.size[0]]:n[o]=t[r-1];else if("symmetric"===e.value){if(e.size[0]>r||e.size[1]>r)throw new RangeError("expanded value should not be bigger than the data length");for(o=0;o<i;o++)o<e.size[0]?n[o]=t[e.size[0]-1-o]:o<e.size[0]+r?n[o]=t[o-e.size[0]]:n[o]=t[2*r+e.size[0]-o-1]}else for(o=0;o<i;o++)o<e.size[0]?n[o]=e.value:o<e.size[0]+r?n[o]=t[o-e.size[0]]:n[o]=e.value;return n}(t,e);throw new TypeError("data should be an array")};const jt={windowSize:5,derivative:1,polynomial:2,pad:"none",padValue:"replicate"};function Yt(t,e,r){if((r=Object.assign({},jt,r)).windowSize%2==0||r.windowSize<5||!Number.isInteger(r.windowSize))throw new RangeError("Invalid window size (should be odd and at least 5 integer number)");if(r.derivative<0||!Number.isInteger(r.derivative))throw new RangeError("Derivative should be a positive integer");if(r.polynomial<1||!Number.isInteger(r.polynomial))throw new RangeError("Polynomial should be a positive integer");let n,o,i=Math.floor(r.windowSize/2);"pre"===r.pad&&(t=_t(t,{size:i,value:r.padValue}));let s=new Array(t.length-2*i);if(5!==r.windowSize||2!==r.polynomial||1!==r.derivative&&2!==r.derivative){let t=st.ones(r.windowSize,r.polynomial+1),e=-(r.windowSize-1)/2;for(let r=0;r<t.rows;r++)for(let n=0;n<t.columns;n++)e+1===0&&0===n||t.set(r,n,Math.pow(e+r,n));let i=new lt(t);n=function(t,e=!1){return t=ut.checkMatrix(t),e?new mt(t).inverse():pt(t,st.eye(t.rows))}(i.mmul(t)).mmul(i),n=n.getRow(r.derivative),o=1/function(t){let e=1;for(;t>0;)e*=t--;return e}(r.derivative)}else 1===r.derivative?(n=[-2,-1,0,1,2],o=10):(n=[2,-1,-2,-1,2],o=7);let a=o*Math.pow(e,r.derivative);for(let e=i;e<t.length-i;e++){let r=0;for(let o=0;o<n.length;o++)r+=n[o]*t[o+e-i]/a;s[e-i]=r}return"post"===r.pad&&(s=_t(s,{size:i,value:r.padValue})),s}var Wt={};function Bt(t,e={}){var r;let n={x:t.variables.x.data,y:t.variables.y.data},o={variables:{x:{data:t.variables.x.data,units:t.variables.x.units,label:t.variables.x.label},y:{data:t.variables.y.data,units:t.variables.y.units,label:t.variables.y.label}}};t.title&&(o.title=t.title),t.dataType&&(o.dataType=t.dataType),t.meta&&(o.meta=t.meta);let{from:i=t.variables.x.min,to:u=t.variables.x.max,numberOfPoints:h,filters:c=[],exclusions:m=[],processing:p="",keepYUnits:y=!1}=e,{x:v,y:x}=Xt(n,{from:i,to:u});switch(p){case"firstDerivative":e.processing&&(o.variables.y.units="",o.variables.y.label=o.variables.y.label&&`1st derivative of ${o.variables.y.label.replace(/\s*\[.*\]/,"")}`,x=Yt(x,1,{derivative:1,polynomial:2,windowSize:5}),v=v.slice(2,v.length-2));break;case"secondDerivative":e.processing&&(o.variables.y.units="",o.variables.y.label=o.variables.y.label&&`2nd derivative of ${o.variables.y.label.replace(/\s*\[.*\]/,"")}`,x=Yt(x,1,{derivative:2,polynomial:2,windowSize:5}),v=v.slice(2,v.length-2));break;case"thirdDerivative":e.processing&&(o.variables.y.units="",o.variables.y.label=o.variables.y.label&&`3rd derivative of ${o.variables.y.label.replace(/\s*\[.*\]/,"")}`,x=Yt(x,1,{derivative:3,polynomial:2,windowSize:5}),v=v.slice(2,v.length-2))}!y&&c.length&&(o.variables.y.units="",o.variables.y.label=null===(r=o.variables.y.label)||void 0===r?void 0:r.replace(/\s*\[.*\]/,""));for(let t of c){let e=t.options||{};switch(t.name.toLowerCase()){case"centermean":x=w(x,Wt.mean(x));break;case"dividebysd":x=l(x,Wt.standardDeviation(x));break;case"normalize":x=Ot(x,{sumValue:e.value?Number(e.value):1,algorithm:"absolute"});break;case"rescale":x=_(x,{min:e.min?Number(e.min):0,max:e.max?Number(e.max):1});break;case"dividebymax":x=l(x,d(x));break;case"multiply":x=a(x,e.value?Number(e.value):1);break;case"add":x=s(x,e.value?Number(e.value):0);break;case"airplsbaseline":x=St(x,e).correctedSpectrum;break;case"rollingaveragebaseline":x=Ct(x,e).correctedSpectrum;break;case"iterativepolynomialbaseline":x=Nt(x,void 0).correctedSpectrum;break;case"rollingballbaseline":x=It(x,e).correctedSpectrum;break;case"rollingmedianbaseline":x=$t(x,e).correctedSpectrum;break;case"ensuregrowing":{const t=b({x:v,y:x});v=t.x,x=t.y;break}case"":case void 0:break;default:throw new Error(`Unknown process kind: ${t.name}`)}}return n=h?Dt({x:v,y:x},{from:i,to:u,numberOfPoints:h,exclusions:m}):Xt({x:v,y:x},{from:i,to:u,exclusions:m}),o.variables.x.data=v,o.variables.x.min=g(v),o.variables.x.max=d(v),o.variables.x.isMonotone=f(v),o.variables.y.data=x,o.variables.y.min=g(x),o.variables.y.max=d(x),o.variables.y.isMonotone=f(x),o}!function(t){function e(t,e){return t-e}t.sum=function(t){for(var e=0,r=0;r<t.length;r++)e+=t[r];return e},t.max=function(t){for(var e=t[0],r=t.length,n=1;n<r;n++)t[n]>e&&(e=t[n]);return e},t.min=function(t){for(var e=t[0],r=t.length,n=1;n<r;n++)t[n]<e&&(e=t[n]);return e},t.minMax=function(t){for(var e=t[0],r=t[0],n=t.length,o=1;o<n;o++)t[o]<e&&(e=t[o]),t[o]>r&&(r=t[o]);return{min:e,max:r}},t.arithmeticMean=function(t){for(var e=0,r=t.length,n=0;n<r;n++)e+=t[n];return e/r},t.mean=t.arithmeticMean,t.geometricMean=function(t){for(var e=1,r=t.length,n=0;n<r;n++)e*=t[n];return Math.pow(e,1/r)},t.logMean=function(t){for(var e=0,r=t.length,n=0;n<r;n++)e+=Math.log(t[n]);return e/r},t.grandMean=function(t,e){for(var r=0,n=0,o=t.length,i=0;i<o;i++)r+=e[i]*t[i],n+=e[i];return r/n},t.truncatedMean=function(t,r,n){void 0===n&&(n=!1),n||(t=[].concat(t).sort(e));for(var o=t.length,i=Math.floor(o*r),s=0,a=i;a<o-i;a++)s+=t[a];return s/(o-2*i)},t.harmonicMean=function(t){for(var e=0,r=t.length,n=0;n<r;n++){if(0===t[n])throw new RangeError("value at index "+n+"is zero");e+=1/t[n]}return r/e},t.contraHarmonicMean=function(t){for(var e=0,r=0,n=t.length,o=0;o<n;o++)e+=t[o]*t[o],r+=t[o];if(r<0)throw new RangeError("sum of values is negative");return e/r},t.median=function(t,r){void 0===r&&(r=!1),r||(t=[].concat(t).sort(e));var n=t.length,o=Math.floor(n/2);return n%2==0?.5*(t[o-1]+t[o]):t[o]},t.variance=function(e,r){void 0===r&&(r=!0);for(var n=t.mean(e),o=0,i=e.length,s=0;s<i;s++){var a=e[s]-n;o+=a*a}return r?o/(i-1):o/i},t.standardDeviation=function(e,r){return Math.sqrt(t.variance(e,r))},t.standardError=function(e){return t.standardDeviation(e)/Math.sqrt(e.length)},t.robustMeanAndStdev=function(t){var r=0,n=t.length,o=0;for(o=0;o<n;o++)r+=t[o];r/=n;var i=new Array(n);for(o=0;o<n;o++)i[o]=Math.abs(t[o]-r);return i.sort(e),{mean:r,stdev:n%2==1?i[(n-1)/2]/.6745:.5*(i[n/2]+i[n/2-1])/.6745}},t.quartiles=function(r,n){void 0===n&&(n=!1),n||(r=[].concat(r).sort(e));var o=r.length/4;return{q1:r[Math.ceil(o)-1],q2:t.median(r,!0),q3:r[Math.ceil(3*o)-1]}},t.pooledStandardDeviation=function(e,r){return Math.sqrt(t.pooledVariance(e,r))},t.pooledVariance=function(e,r){void 0===r&&(r=!0);for(var n=0,o=0,i=e.length,s=0;s<i;s++){var a=e[s],l=t.variance(a);n+=(a.length-1)*l,o+=r?a.length-1:a.length}return n/o},t.mode=function(t){var e,r=t.length,n=new Array(r);for(e=0;e<r;e++)n[e]=0;var o=new Array(r),i=0;for(e=0;e<r;e++){var s=o.indexOf(t[e]);s>=0?n[s]++:(o[i]=t[e],n[i]=1,i++)}var a=0,l=0;for(e=0;e<i;e++)n[e]>a&&(a=n[e],l=e);return o[l]},t.covariance=function(e,r,n){void 0===n&&(n=!0);var o=t.mean(e),i=t.mean(r);if(e.length!==r.length)throw"Vectors do not have the same dimensions";for(var s=0,a=e.length,l=0;l<a;l++){s+=(e[l]-o)*(r[l]-i)}return n?s/(a-1):s/a},t.skewness=function(e,r){void 0===r&&(r=!0);for(var n=t.mean(e),o=0,i=0,s=e.length,a=0;a<s;a++){var l=e[a]-n;o+=l*l,i+=l*l*l}var u=o/s,h=i/s/Math.pow(u,1.5);return r?Math.sqrt(s*(s-1))/(s-2)*h:h},t.kurtosis=function(e,r){void 0===r&&(r=!0);for(var n=t.mean(e),o=e.length,i=0,s=0,a=0;a<o;a++){var l=e[a]-n;i+=l*l,s+=l*l*l*l}var u=i/o;if(r){var h=i/(o-1);return o*(o+1)/((o-1)*(o-2)*(o-3))*(s/(h*h))-3*((o-1)*(o-1)/((o-2)*(o-3)))}return s/o/(u*u)-3},t.entropy=function(t,e){void 0===e&&(e=0);for(var r=0,n=t.length,o=0;o<n;o++)r+=t[o]*Math.log(t[o]+e);return-r},t.weightedMean=function(t,e){for(var r=0,n=t.length,o=0;o<n;o++)r+=t[o]*e[o];return r},t.weightedStandardDeviation=function(e,r){return Math.sqrt(t.weightedVariance(e,r))},t.weightedVariance=function(e,r){for(var n=t.weightedMean(e,r),o=0,i=e.length,s=0,a=0,l=0;l<i;l++){var u=e[l]-n,h=r[l];o+=h*(u*u),a+=h,s+=h*h}return o*(a/(a*a-s))},t.center=function(e,r){void 0===r&&(r=!1);var n=e;r||(n=[].concat(e));for(var o=t.mean(n),i=n.length,s=0;s<i;s++)n[s]-=o},t.standardize=function(e,r,n){void 0===r&&(r=t.standardDeviation(e)),void 0===n&&(n=!1);for(var o=e.length,i=n?e:new Array(o),s=0;s<o;s++)i[s]=e[s]/r;return i},t.cumulativeSum=function(t){var e=t.length,r=new Array(e);r[0]=t[0];for(var n=1;n<e;n++)r[n]=r[n-1]+t[n];return r}}(Wt);var Ht={exports:{}};!function(t,e){t.exports=function(){function t(t){return"string"==typeof t||t instanceof String}var e=Number.isFinite||window.isFinite;function r(t){return e(t)}function n(t){return t}function o(t){var e={};return t.filter((function(t){return!e.hasOwnProperty(t)&&(e[t]=!0)}))}function i(t,e){if(e.length!==t.length)return!1;for(var r=0;r<t.length;r++){if(e[r].compareArray&&!e[r].compareArray(t[r]))return!1;if(e[r]!==t[r])return!1}return!0}function s(t,e){Object.keys(e).forEach((function(r){t[r]=e[r]}))}function a(){for(var t=1,e=0,r=0;r<arguments.length;r++){var n=arguments[r];e+=h(n),t*=n}return 0!==e?u(t,e):t}function l(t,e){if(0===e)throw new Error("Divide by zero");var r=Math.pow(10,h(e));return a(t,r/(r*e))}function u(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)}function h(t){if(!isFinite(t))return 0;for(var e=0;t%1!=0;)t*=10,e++;return e}function c(){var t;if(!this)return t=Object.create(c.prototype),c.apply(t,arguments),t;t=Error.apply(this,arguments),this.name="QtyError",this.message=t.message,this.stack=t.stack}function f(t,e){throw new c("Incompatible units: "+t+" and "+e)}c.prototype=Object.create(Error.prototype,{constructor:{value:c}});var m={"<googol>":[["googol"],1e100,"prefix"],"<kibi>":[["Ki","Kibi","kibi"],Math.pow(2,10),"prefix"],"<mebi>":[["Mi","Mebi","mebi"],Math.pow(2,20),"prefix"],"<gibi>":[["Gi","Gibi","gibi"],Math.pow(2,30),"prefix"],"<tebi>":[["Ti","Tebi","tebi"],Math.pow(2,40),"prefix"],"<pebi>":[["Pi","Pebi","pebi"],Math.pow(2,50),"prefix"],"<exi>":[["Ei","Exi","exi"],Math.pow(2,60),"prefix"],"<zebi>":[["Zi","Zebi","zebi"],Math.pow(2,70),"prefix"],"<yebi>":[["Yi","Yebi","yebi"],Math.pow(2,80),"prefix"],"<yotta>":[["Y","Yotta","yotta"],1e24,"prefix"],"<zetta>":[["Z","Zetta","zetta"],1e21,"prefix"],"<exa>":[["E","Exa","exa"],1e18,"prefix"],"<peta>":[["P","Peta","peta"],1e15,"prefix"],"<tera>":[["T","Tera","tera"],1e12,"prefix"],"<giga>":[["G","Giga","giga"],1e9,"prefix"],"<mega>":[["M","Mega","mega"],1e6,"prefix"],"<kilo>":[["k","kilo"],1e3,"prefix"],"<hecto>":[["h","Hecto","hecto"],100,"prefix"],"<deca>":[["da","Deca","deca","deka"],10,"prefix"],"<deci>":[["d","Deci","deci"],.1,"prefix"],"<centi>":[["c","Centi","centi"],.01,"prefix"],"<milli>":[["m","Milli","milli"],.001,"prefix"],"<micro>":[["u","","","Micro","mc","micro"],1e-6,"prefix"],"<nano>":[["n","Nano","nano"],1e-9,"prefix"],"<pico>":[["p","Pico","pico"],1e-12,"prefix"],"<femto>":[["f","Femto","femto"],1e-15,"prefix"],"<atto>":[["a","Atto","atto"],1e-18,"prefix"],"<zepto>":[["z","Zepto","zepto"],1e-21,"prefix"],"<yocto>":[["y","Yocto","yocto"],1e-24,"prefix"],"<1>":[["1","<1>"],1,""],"<meter>":[["m","meter","meters","metre","metres"],1,"length",["<meter>"]],"<inch>":[["in","inch","inches",'"'],.0254,"length",["<meter>"]],"<foot>":[["ft","foot","feet","'"],.3048,"length",["<meter>"]],"<yard>":[["yd","yard","yards"],.9144,"length",["<meter>"]],"<mile>":[["mi","mile","miles"],1609.344,"length",["<meter>"]],"<naut-mile>":[["nmi","naut-mile"],1852,"length",["<meter>"]],"<league>":[["league","leagues"],4828,"length",["<meter>"]],"<furlong>":[["furlong","furlongs"],201.2,"length",["<meter>"]],"<rod>":[["rd","rod","rods"],5.029,"length",["<meter>"]],"<mil>":[["mil","mils"],254e-7,"length",["<meter>"]],"<angstrom>":[["ang","angstrom","angstroms"],1e-10,"length",["<meter>"]],"<fathom>":[["fathom","fathoms"],1.829,"length",["<meter>"]],"<pica>":[["pica","picas"],.00423333333,"length",["<meter>"]],"<point>":[["pt","point","points"],.000352777778,"length",["<meter>"]],"<redshift>":[["z","red-shift","redshift"],1302773e20,"length",["<meter>"]],"<AU>":[["AU","astronomical-unit"],1495979e5,"length",["<meter>"]],"<light-second>":[["ls","light-second"],299792500,"length",["<meter>"]],"<light-minute>":[["lmin","light-minute"],1798755e4,"length",["<meter>"]],"<light-year>":[["ly","light-year"],9460528e9,"length",["<meter>"]],"<parsec>":[["pc","parsec","parsecs"],3085678e10,"length",["<meter>"]],"<datamile>":[["DM","datamile"],1828.8,"length",["<meter>"]],"<kilogram>":[["kg","kilogram","kilograms"],1,"mass",["<kilogram>"]],"<AMU>":[["u","AMU","amu"],1660538921e-36,"mass",["<kilogram>"]],"<dalton>":[["Da","Dalton","Daltons","dalton","daltons"],1660538921e-36,"mass",["<kilogram>"]],"<slug>":[["slug","slugs"],14.5939029,"mass",["<kilogram>"]],"<short-ton>":[["tn","ton","short-ton"],907.18474,"mass",["<kilogram>"]],"<metric-ton>":[["tonne","metric-ton"],1e3,"mass",["<kilogram>"]],"<carat>":[["ct","carat","carats"],2e-4,"mass",["<kilogram>"]],"<pound>":[["lbs","lb","pound","pounds","#"],.45359237,"mass",["<kilogram>"]],"<ounce>":[["oz","ounce","ounces"],.0283495231,"mass",["<kilogram>"]],"<gram>":[["g","gram","grams","gramme","grammes"],.001,"mass",["<kilogram>"]],"<grain>":[["grain","grains","gr"],6479891e-11,"mass",["<kilogram>"]],"<dram>":[["dram","drams","dr"],.0017718452,"mass",["<kilogram>"]],"<stone>":[["stone","stones","st"],6.35029318,"mass",["<kilogram>"]],"<hectare>":[["hectare"],1e4,"area",["<meter>","<meter>"]],"<acre>":[["acre","acres"],4046.85642,"area",["<meter>","<meter>"]],"<sqft>":[["sqft"],1,"area",["<foot>","<foot>"]],"<liter>":[["l","L","liter","liters","litre","litres"],.001,"volume",["<meter>","<meter>","<meter>"]],"<gallon>":[["gal","gallon","gallons"],.0037854118,"volume",["<meter>","<meter>","<meter>"]],"<gallon-imp>":[["galimp","gallon-imp","gallons-imp"],.00454609,"volume",["<meter>","<meter>","<meter>"]],"<quart>":[["qt","quart","quarts"],.00094635295,"volume",["<meter>","<meter>","<meter>"]],"<pint>":[["pt","pint","pints"],.000473176475,"volume",["<meter>","<meter>","<meter>"]],"<pint-imp>":[["ptimp","pint-imp","pints-imp"],.00056826125,"volume",["<meter>","<meter>","<meter>"]],"<cup>":[["cu","cup","cups"],.000236588238,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce>":[["floz","fluid-ounce","fluid-ounces"],295735297e-13,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce-imp>":[["flozimp","floz-imp","fluid-ounce-imp","fluid-ounces-imp"],284130625e-13,"volume",["<meter>","<meter>","<meter>"]],"<tablespoon>":[["tb","tbsp","tbs","tablespoon","tablespoons"],147867648e-13,"volume",["<meter>","<meter>","<meter>"]],"<teaspoon>":[["tsp","teaspoon","teaspoons"],492892161e-14,"volume",["<meter>","<meter>","<meter>"]],"<bushel>":[["bu","bsh","bushel","bushels"],.035239072,"volume",["<meter>","<meter>","<meter>"]],"<oilbarrel>":[["bbl","oilbarrel","oilbarrels","oil-barrel","oil-barrels"],.158987294928,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel>":[["bl","bl-us","beerbarrel","beerbarrels","beer-barrel","beer-barrels"],.1173477658,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel-imp>":[["blimp","bl-imp","beerbarrel-imp","beerbarrels-imp","beer-barrel-imp","beer-barrels-imp"],.16365924,"volume",["<meter>","<meter>","<meter>"]],"<kph>":[["kph"],.277777778,"speed",["<meter>"],["<second>"]],"<mph>":[["mph"],.44704,"speed",["<meter>"],["<second>"]],"<knot>":[["kt","kn","kts","knot","knots"],.514444444,"speed",["<meter>"],["<second>"]],"<fps>":[["fps"],.3048,"speed",["<meter>"],["<second>"]],"<gee>":[["gee"],9.80665,"acceleration",["<meter>"],["<second>","<second>"]],"<Gal>":[["Gal"],.01,"acceleration",["<meter>"],["<second>","<second>"]],"<kelvin>":[["degK","kelvin"],1,"temperature",["<kelvin>"]],"<celsius>":[["degC","celsius","celsius","centigrade"],1,"temperature",["<kelvin>"]],"<fahrenheit>":[["degF","fahrenheit"],5/9,"temperature",["<kelvin>"]],"<rankine>":[["degR","rankine"],5/9,"temperature",["<kelvin>"]],"<temp-K>":[["tempK","temp-K"],1,"temperature",["<temp-K>"]],"<temp-C>":[["tempC","temp-C"],1,"temperature",["<temp-K>"]],"<temp-F>":[["tempF","temp-F"],5/9,"temperature",["<temp-K>"]],"<temp-R>":[["tempR","temp-R"],5/9,"temperature",["<temp-K>"]],"<second>":[["s","sec","secs","second","seconds"],1,"time",["<second>"]],"<minute>":[["min","mins","minute","minutes"],60,"time",["<second>"]],"<hour>":[["h","hr","hrs","hour","hours"],3600,"time",["<second>"]],"<day>":[["d","day","days"],86400,"time",["<second>"]],"<week>":[["wk","week","weeks"],604800,"time",["<second>"]],"<fortnight>":[["fortnight","fortnights"],1209600,"time",["<second>"]],"<year>":[["y","yr","year","years","annum"],31556926,"time",["<second>"]],"<decade>":[["decade","decades"],315569260,"time",["<second>"]],"<century>":[["century","centuries"],3155692600,"time",["<second>"]],"<pascal>":[["Pa","pascal","Pascal"],1,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<bar>":[["bar","bars"],1e5,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<mmHg>":[["mmHg"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inHg>":[["inHg"],3386.3881472,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<torr>":[["torr"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<atm>":[["atm","ATM","atmosphere","atmospheres"],101325,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<psi>":[["psi"],6894.76,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<cmh2o>":[["cmH2O","cmh2o"],98.0638,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inh2o>":[["inH2O","inh2o"],249.082052,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<poise>":[["P","poise"],.1,"viscosity",["<kilogram>"],["<meter>","<second>"]],"<stokes>":[["St","stokes"],1e-4,"viscosity",["<meter>","<meter>"],["<second>"]],"<mole>":[["mol","mole"],1,"substance",["<mole>"]],"<molar>":[["M","molar"],1e3,"concentration",["<mole>"],["<meter>","<meter>","<meter>"]],"<wtpercent>":[["wt%","wtpercent"],10,"concentration",["<kilogram>"],["<meter>","<meter>","<meter>"]],"<katal>":[["kat","katal","Katal"],1,"activity",["<mole>"],["<second>"]],"<unit>":[["U","enzUnit","unit"],16667e-19,"activity",["<mole>"],["<second>"]],"<farad>":[["F","farad","Farad"],1,"capacitance",["<second>","<second>","<second>","<second>","<ampere>","<ampere>"],["<meter>","<meter>","<kilogram>"]],"<coulomb>":[["C","coulomb","Coulomb"],1,"charge",["<ampere>","<second>"]],"<Ah>":[["Ah"],3600,"charge",["<ampere>","<second>"]],"<ampere>":[["A","Ampere","ampere","amp","amps"],1,"current",["<ampere>"]],"<siemens>":[["S","Siemens","siemens"],1,"conductance",["<second>","<second>","<second>","<ampere>","<ampere>"],["<kilogram>","<meter>","<meter>"]],"<henry>":[["H","Henry","henry"],1,"inductance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>","<ampere>"]],"<volt>":[["V","Volt","volt","volts"],1,"potential",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>"]],"<ohm>":[["Ohm","ohm","",""],1,"resistance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>","<ampere>"]],"<weber>":[["Wb","weber","webers"],1,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<tesla>":[["T","tesla","teslas"],1,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<gauss>":[["G","gauss"],1e-4,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<maxwell>":[["Mx","maxwell","maxwells"],1e-8,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<oersted>":[["Oe","oersted","oersteds"],250/Math.PI,"magnetism",["<ampere>"],["<meter>"]],"<joule>":[["J","joule","Joule","joules"],1,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<erg>":[["erg","ergs"],1e-7,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<btu>":[["BTU","btu","BTUs"],1055.056,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<calorie>":[["cal","calorie","calories"],4.184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Calorie>":[["Cal","Calorie","Calories"],4184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<therm-US>":[["th","therm","therms","Therm","therm-US"],105480400,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Wh>":[["Wh"],3600,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<newton>":[["N","Newton","newton"],1,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<dyne>":[["dyn","dyne"],1e-5,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<pound-force>":[["lbf","pound-force"],4.448222,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<hertz>":[["Hz","hertz","Hertz"],1,"frequency",["<1>"],["<second>"]],"<radian>":[["rad","radian","radians"],1,"angle",["<radian>"]],"<degree>":[["deg","degree","degrees"],Math.PI/180,"angle",["<radian>"]],"<gradian>":[["gon","grad","gradian","grads"],Math.PI/200,"angle",["<radian>"]],"<steradian>":[["sr","steradian","steradians"],1,"solid_angle",["<steradian>"]],"<rotation>":[["rotation"],2*Math.PI,"angle",["<radian>"]],"<rpm>":[["rpm"],2*Math.PI/60,"angular_velocity",["<radian>"],["<second>"]],"<byte>":[["B","byte","bytes"],1,"information",["<byte>"]],"<bit>":[["b","bit","bits"],.125,"information",["<byte>"]],"<Bps>":[["Bps"],1,"information_rate",["<byte>"],["<second>"]],"<bps>":[["bps"],.125,"information_rate",["<byte>"],["<second>"]],"<dollar>":[["USD","dollar"],1,"currency",["<dollar>"]],"<cents>":[["cents"],.01,"currency",["<dollar>"]],"<candela>":[["cd","candela"],1,"luminosity",["<candela>"]],"<lumen>":[["lm","lumen"],1,"luminous_power",["<candela>","<steradian>"]],"<lux>":[["lux"],1,"illuminance",["<candela>","<steradian>"],["<meter>","<meter>"]],"<watt>":[["W","watt","watts"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere>":[["VA","volt-ampere"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere-reactive>":[["var","Var","VAr","VAR","volt-ampere-reactive"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<horsepower>":[["hp","horsepower"],745.699872,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<gray>":[["Gy","gray","grays"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<roentgen>":[["R","roentgen"],.00933,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<sievert>":[["Sv","sievert","sieverts"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<becquerel>":[["Bq","becquerel","becquerels"],1,"radiation",["<1>"],["<second>"]],"<curie>":[["Ci","curie","curies"],37e9,"radiation",["<1>"],["<second>"]],"<cpm>":[["cpm"],1/60,"rate",["<count>"],["<second>"]],"<dpm>":[["dpm"],1/60,"rate",["<count>"],["<second>"]],"<bpm>":[["bpm"],1/60,"rate",["<count>"],["<second>"]],"<dot>":[["dot","dots"],1,"resolution",["<each>"]],"<pixel>":[["pixel","px"],1,"resolution",["<each>"]],"<ppi>":[["ppi"],1,"resolution",["<pixel>"],["<inch>"]],"<dpi>":[["dpi"],1,"typography",["<dot>"],["<inch>"]],"<cell>":[["cells","cell"],1,"counting",["<each>"]],"<each>":[["each"],1,"counting",["<each>"]],"<count>":[["count"],1,"counting",["<each>"]],"<base-pair>":[["bp","base-pair"],1,"counting",["<each>"]],"<nucleotide>":[["nt","nucleotide"],1,"counting",["<each>"]],"<molecule>":[["molecule","molecules"],1,"counting",["<1>"]],"<dozen>":[["doz","dz","dozen"],12,"prefix_only",["<each>"]],"<percent>":[["%","percent"],.01,"prefix_only",["<1>"]],"<ppm>":[["ppm"],1e-6,"prefix_only",["<1>"]],"<ppt>":[["ppt"],1e-9,"prefix_only",["<1>"]],"<gross>":[["gr","gross"],144,"prefix_only",["<dozen>","<dozen>"]],"<decibel>":[["dB","decibel","decibels"],1,"logarithmic",["<decibel>"]]},p=["<meter>","<kilogram>","<second>","<mole>","<ampere>","<radian>","<kelvin>","<temp-K>","<byte>","<dollar>","<candela>","<each>","<steradian>","<decibel>"],g="<1>",d=[g];function w(t,e){var n=e[1],o=e[3]||[],i=e[4]||[];if(!r(n))throw new c(t+": Invalid unit definition. 'scalar' must be a number");o.forEach((function(e){if(void 0===m[e])throw new c(t+": Invalid unit definition. Unit "+e+" in 'numerator' is not recognized")})),i.forEach((function(e){if(void 0===m[e])throw new c(t+": Invalid unit definition. Unit "+e+" in 'denominator' is not recognized")}))}var y={},b={},v={},x={},M={};for(var E in m)if(m.hasOwnProperty(E)){var A=m[E];if("prefix"===A[2]){y[E]=A[1];for(var S=0;S<A[0].length;S++)b[A[0][S]]=E}else{w(E,A),v[E]={scalar:A[1],numerator:A[3],denominator:A[4]};for(var T=0;T<A[0].length;T++)x[A[0][T]]=E}M[E]=A[0][0]}function k(t){var e,r=[],n=Object.keys(m);if(void 0===t)for(e=0;e<n.length;e++)-1===["","prefix"].indexOf(m[n[e]][2])&&r.push(n[e].substr(1,n[e].length-2));else{if(-1===this.getKinds().indexOf(t))throw new c("Kind not recognized");for(e=0;e<n.length;e++)m[n[e]][2]===t&&r.push(n[e].substr(1,n[e].length-2))}return r.sort((function(t,e){return t.toLowerCase()<e.toLowerCase()?-1:t.toLowerCase()>e.toLowerCase()?1:0}))}function F(t){if(!x[t])throw new c("Unit not recognized");return m[x[t]][0]}var N=["length","time","temperature","mass","current","substance","luminosity","currency","information","angle"];function R(){if(this.signature)return this.signature;for(var t=z.call(this),e=0;e<t.length;e++)t[e]*=Math.pow(20,e);return t.reduce((function(t,e){return t+e}),0)}function z(){if(!this.isBase())return z.call(this.toBase());for(var t,e,r=new Array(N.length),n=0;n<r.length;n++)r[n]=0;for(var o=0;o<this.numerator.length;o++)(t=m[this.numerator[o]])&&(e=N.indexOf(t[2]))>=0&&(r[e]=r[e]+1);for(var i=0;i<this.denominator.length;i++)(t=m[this.denominator[i]])&&(e=N.indexOf(t[2]))>=0&&(r[e]=r[e]-1);return r}var C="[+-]",I="\\d+",$="\\."+I,O=new RegExp("^("+C+"?\\s*(?:(?:"+I+"(?:"+$+")?)|(?:"+$+"))(?:[Ee]"+C+"?"+I+")?)?\\s*([^/]*)(?:/(.+))?$"),P="\\^|\\*{2}",U="[01234]",V=new RegExp("([^ \\*\\d]+?)(?:"+P+")?(-?"+U+"(?![a-zA-Z]))"),D=new RegExp("([^ \\*\\d]+?)(?:"+P+")?("+U+"(?![a-zA-Z]))");function L(e){t(e)||(e=e.toString()),e=e.trim();var r=O.exec(e);if(!r)throw new c(e+": Quantity not recognized");var n=r[1];n?(n=n.replace(/\s/g,""),this.scalar=parseFloat(n)):this.scalar=1;for(var o,i,s,a=r[2],l=r[3];r=V.exec(a);){if(o=parseFloat(r[2]),isNaN(o))throw new c("Unit exponent is not a number");if(0===o&&!j.test(r[1]))throw new c("Unit not recognized");i=r[1]+" ",s="";for(var u=0;u<Math.abs(o);u++)s+=i;o>=0?a=a.replace(r[0],s):(l=l?l+s:s,a=a.replace(r[0],""))}for(;r=D.exec(l);){if(o=parseFloat(r[2]),isNaN(o))throw new c("Unit exponent is not a number");if(0===o&&!j.test(r[1]))throw new c("Unit not recognized");i=r[1]+" ",s="";for(var h=0;h<o;h++)s+=i;l=l.replace(r[0],s)}a&&(this.numerator=B(a.trim())),l&&(this.denominator=B(l.trim()))}var X=Object.keys(b).sort((function(t,e){return e.length-t.length})).join("|"),q=Object.keys(x).sort((function(t,e){return e.length-t.length})).join("|"),_="("+X+")??("+q+")(?:\\b|$)",j=new RegExp("^\\s*("+_+"[\\s\\*]*)+$"),Y=new RegExp(_,"g"),W={};function B(t){var e=W[t];if(e)return e;var r,n=[];if(!j.test(t))throw new c("Unit not recognized");for(;r=Y.exec(t);)n.push(r.slice(1));return n=(n=(n=n.map((function(t){return b[t[0]]?[b[t[0]],x[t[1]]]:[x[t[1]]]}))).reduce((function(t,e){return t.concat(e)}),[])).filter((function(t){return t})),W[t]=n,n}function H(e){if(!t(e))throw new c("Argument should be a string");try{return this(e)}catch(t){return null}}function K(t){return t instanceof G}function G(t,e){if(Z.apply(null,arguments),!K(this))return new G(t,e);if(this.scalar=null,this.baseScalar=null,this.signature=null,this._conversionCache={},this.numerator=d,this.denominator=d,J(t)?(this.scalar=t.scalar,this.numerator=t.numerator&&0!==t.numerator.length?t.numerator:d,this.denominator=t.denominator&&0!==t.denominator.length?t.denominator:d):e?(L.call(this,e),this.scalar=t):L.call(this,t),this.denominator.join("*").indexOf("temp")>=0)throw new c("Cannot divide with temperatures");if(this.numerator.join("*").indexOf("temp")>=0){if(this.numerator.length>1)throw new c("Cannot multiply by temperatures");if(!i(this.denominator,d))throw new c("Cannot divide with temperatures")}if(this.initValue=t,Q.call(this),this.isTemperature()&&this.baseScalar<0)throw new c("Temperatures must not be less than absolute zero")}function Z(e,n){if(n){if(!r(e)||!t(n))throw new c("Only number accepted as initialization value when units are explicitly provided")}else if(!(t(e)||r(e)||K(e)||J(e)))throw new c("Only string, number or quantity accepted as single initialization value")}function J(t){return t&&"object"==typeof t&&t.hasOwnProperty("scalar")}function Q(){if(this.baseScalar)return this.baseScalar;if(this.isBase())this.baseScalar=this.scalar,this.signature=R.call(this);else{var t=this.toBase();this.baseScalar=t.scalar,this.signature=t.signature}}G.prototype={constructor:G};var tt={"-312078":"elastance","-312058":"resistance","-312038":"inductance","-152058":"potential","-152040":"magnetism","-152038":"magnetism","-7997":"specific_volume","-79":"snap","-59":"jolt","-39":"acceleration","-38":"radiation","-20":"frequency","-19":"speed","-18":"viscosity","-17":"volumetric_flow","-1":"wavenumber",0:"unitless",1:"length",2:"area",3:"volume",20:"time",400:"temperature",7941:"yank",7942:"power",7959:"pressure",7961:"force",7962:"energy",7979:"viscosity",7981:"momentum",7982:"angular_momentum",7997:"density",7998:"area_density",8e3:"mass",152020:"radiation_exposure",159999:"magnetism",16e4:"current",160020:"charge",312058:"conductance",312078:"capacitance",3199980:"activity",3199997:"molar_concentration",32e5:"substance",63999998:"illuminance",64e6:"luminous_power",128e7:"currency",25599999980:"information_rate",256e8:"information",511999999980:"angular_velocity",512e9:"angle"};function et(){return o(Object.keys(tt).map((function(t){return tt[t]})))}function rt(t,e){var r=t.units(),n=e.to(r),o=G(it(r));return G({scalar:t.scalar-n.scalar,numerator:o.numerator,denominator:o.denominator})}function nt(t,e){var r=e.to(it(t.units()));return G({scalar:t.scalar-r.scalar,numerator:t.numerator,denominator:t.denominator})}function ot(t,e){var r=e.to(it(t.units()));return G({scalar:t.scalar+r.scalar,numerator:t.numerator,denominator:t.denominator})}function it(t){if("tempK"===t)return"degK";if("tempC"===t)return"degC";if("tempF"===t)return"degF";if("tempR"===t)return"degR";throw new c("Unknown type for temp conversion from: "+t)}function st(t,e){var r,n=at(t),o=e.units();if("degK"===o)r=n.scalar;else if("degC"===o)r=n.scalar;else if("degF"===o)r=9*n.scalar/5;else{if("degR"!==o)throw new c("Unknown type for degree conversion to: "+o);r=9*n.scalar/5}return G({scalar:r,numerator:e.numerator,denominator:e.denominator})}function at(t){var e,r=t.units();if(r.match(/(deg)[CFRK]/))e=t.baseScalar;else if("tempK"===r)e=t.scalar;else if("tempC"===r)e=t.scalar;else if("tempF"===r)e=5*t.scalar/9;else{if("tempR"!==r)throw new c("Unknown type for temp conversion from: "+r);e=5*t.scalar/9}return G({scalar:e,numerator:["<kelvin>"],denominator:d})}function lt(t,e){var r,n=e.units();if("tempK"===n)r=t.baseScalar;else if("tempC"===n)r=t.baseScalar-273.15;else if("tempF"===n)r=9*t.baseScalar/5-459.67;else{if("tempR"!==n)throw new c("Unknown type for temp conversion to: "+n);r=9*t.baseScalar/5}return G({scalar:r,numerator:e.numerator,denominator:e.denominator})}function ut(t){var e,r=t.units();if(r.match(/(deg)[CFRK]/))e=t.baseScalar;else if("tempK"===r)e=t.scalar;else if("tempC"===r)e=t.scalar+273.15;else if("tempF"===r)e=5*(t.scalar+459.67)/9;else{if("tempR"!==r)throw new c("Unknown type for temp conversion from: "+r);e=5*t.scalar/9}return G({scalar:e,numerator:["<temp-K>"],denominator:d})}function ht(t,e){var r,o=G(t),i=G(e);return o.eq(i)?n:(r=o.isTemperature()?function(t){return o.mul(t).to(i).scalar}:function(t){return t*o.baseScalar/i.baseScalar},function(t){var e,n,o;if(Array.isArray(t)){for(n=t.length,o=[],e=0;e<n;e++)o.push(r(t[e]));return o}return r(t)})}G.prototype.kind=function(){return tt[this.signature.toString()]},s(G.prototype,{isDegrees:function(){return(null===this.signature||400===this.signature)&&1===this.numerator.length&&i(this.denominator,d)&&(this.numerator[0].match(/<temp-[CFRK]>/)||this.numerator[0].match(/<(kelvin|celsius|rankine|fahrenheit)>/))},isTemperature:function(){return this.isDegrees()&&this.numerator[0].match(/<temp-[CFRK]>/)}}),s(G.prototype,{to:function(e){var r,n;return null==e?this:t(e)?(r=this._conversionCache[e])?r:(n=G(e)).units()===this.units()?this:(this.isCompatible(n)?n=n.isTemperature()?lt(this,n):n.isDegrees()?st(this,n):G({scalar:l(this.baseScalar,n.baseScalar),numerator:n.numerator,denominator:n.denominator}):this.isInverse(n)?n=this.inverse().to(e):f(this.units(),n.units()),this._conversionCache[e]=n,n):this.to(e.units())},toBase:function(){if(this.isBase())return this;if(this.isTemperature())return ut(this);var t=ct[this.units()];return t||(t=ft(this.numerator,this.denominator),ct[this.units()]=t),t.mul(this.scalar)},toFloat:function(){if(this.isUnitless())return this.scalar;throw new c("Can't convert to Float unless unitless.  Use Unit#scalar")},toPrec:function(e){if(t(e)&&(e=G(e)),r(e)&&(e=G(e+" "+this.units())),this.isUnitless()?e.isUnitless()||f(this.units(),e.units()):e=e.to(this.units()),0===e.scalar)throw new c("Divide by zero");return G(a(Math.round(this.scalar/e.scalar),e.scalar)+this.units())}});var ct={};function ft(t,e){for(var r,n=[],o=[],i=1,s=0;s<t.length;s++)r=t[s],y[r]?i=a(i,y[r]):v[r]&&(i*=v[r].scalar,v[r].numerator&&n.push(v[r].numerator),v[r].denominator&&o.push(v[r].denominator));for(var l=0;l<e.length;l++)r=e[l],y[r]?i/=y[r]:v[r]&&(i/=v[r].scalar,v[r].numerator&&o.push(v[r].numerator),v[r].denominator&&n.push(v[r].denominator));return G({scalar:i,numerator:n=n.reduce((function(t,e){return t.concat(e)}),[]),denominator:o=o.reduce((function(t,e){return t.concat(e)}),[])})}function mt(t,e,r,n){function o(t){return t!==g}t=t.filter(o),r=r.filter(o),e=e.filter(o),n=n.filter(o);var i={};function s(t,e){for(var r,n,o,s=0;s<t.length;s++)if(y[t[s]]?(r=t[s+1],n=t[s],o=y[n],s++):(r=t[s],n=null,o=1),r&&r!==g)if(i[r]){i[r][0]+=e;var a=i[r][2]?y[i[r][2]]:1;i[r][1===e?3:4]*=l(o,a)}else i[r]=[e,r,n,1,1]}s(t,1),s(e,-1),s(r,1),s(n,-1);var a=[],u=[],h=1;for(var c in i)if(i.hasOwnProperty(c)){var f,m=i[c];if(m[0]>0)for(f=0;f<m[0];f++)a.push(null===m[2]?m[1]:[m[2],m[1]]);else if(m[0]<0)for(f=0;f<-m[0];f++)u.push(null===m[2]?m[1]:[m[2],m[1]]);h*=l(m[3],m[4])}return 0===a.length&&(a=d),0===u.length&&(u=d),[a=a.reduce((function(t,e){return t.concat(e)}),[]),u=u.reduce((function(t,e){return t.concat(e)}),[]),h]}function pt(){}function gt(t,e){return(t+" "+e).trim()}G.parse=H,G.getUnits=k,G.getAliases=F,G.mulSafe=a,G.divSafe=l,G.getKinds=et,G.swiftConverter=ht,G.Error=c,s(G.prototype,{add:function(e){if(t(e)&&(e=G(e)),this.isCompatible(e)||f(this.units(),e.units()),this.isTemperature()&&e.isTemperature())throw new c("Cannot add two temperatures");return this.isTemperature()?ot(this,e):e.isTemperature()?ot(e,this):G({scalar:this.scalar+e.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},sub:function(e){if(t(e)&&(e=G(e)),this.isCompatible(e)||f(this.units(),e.units()),this.isTemperature()&&e.isTemperature())return rt(this,e);if(this.isTemperature())return nt(this,e);if(e.isTemperature())throw new c("Cannot subtract a temperature from a differential degree unit");return G({scalar:this.scalar-e.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},mul:function(e){if(r(e))return G({scalar:a(this.scalar,e),numerator:this.numerator,denominator:this.denominator});if(t(e)&&(e=G(e)),(this.isTemperature()||e.isTemperature())&&!this.isUnitless()&&!e.isUnitless())throw new c("Cannot multiply by temperatures");var n=this,o=e;n.isCompatible(o)&&400!==n.signature&&(o=o.to(n));var i=mt(n.numerator,n.denominator,o.numerator,o.denominator);return G({scalar:a(n.scalar,o.scalar,i[2]),numerator:i[0],denominator:i[1]})},div:function(e){if(r(e)){if(0===e)throw new c("Divide by zero");return G({scalar:this.scalar/e,numerator:this.numerator,denominator:this.denominator})}if(t(e)&&(e=G(e)),0===e.scalar)throw new c("Divide by zero");if(e.isTemperature())throw new c("Cannot divide with temperatures");if(this.isTemperature()&&!e.isUnitless())throw new c("Cannot divide with temperatures");var n=this,o=e;n.isCompatible(o)&&400!==n.signature&&(o=o.to(n));var i=mt(n.numerator,n.denominator,o.denominator,o.numerator);return G({scalar:a(n.scalar,i[2])/o.scalar,numerator:i[0],denominator:i[1]})},inverse:function(){if(this.isTemperature())throw new c("Cannot divide with temperatures");if(0===this.scalar)throw new c("Divide by zero");return G({scalar:1/this.scalar,numerator:this.denominator,denominator:this.numerator})}}),s(G.prototype,{eq:function(t){return 0===this.compareTo(t)},lt:function(t){return-1===this.compareTo(t)},lte:function(t){return this.eq(t)||this.lt(t)},gt:function(t){return 1===this.compareTo(t)},gte:function(t){return this.eq(t)||this.gt(t)},compareTo:function(e){return t(e)?this.compareTo(G(e)):(this.isCompatible(e)||f(this.units(),e.units()),this.baseScalar<e.baseScalar?-1:this.baseScalar===e.baseScalar?0:this.baseScalar>e.baseScalar?1:void 0)},same:function(t){return this.scalar===t.scalar&&this.units()===t.units()}}),s(G.prototype,{isUnitless:function(){return[this.numerator,this.denominator].every((function(t){return i(t,d)}))},isCompatible:function(e){return t(e)?this.isCompatible(G(e)):!!K(e)&&void 0!==e.signature&&this.signature===e.signature},isInverse:function(t){return this.inverse().isCompatible(t)},isBase:function(){return void 0!==this._isBase?this._isBase:this.isDegrees()&&this.numerator[0].match(/<(kelvin|temp-K)>/)?(this._isBase=!0,this._isBase):(this.numerator.concat(this.denominator).forEach((function(t){t!==g&&-1===p.indexOf(t)&&(this._isBase=!1)}),this),!1===this._isBase||(this._isBase=!0),this._isBase)}}),pt.prototype.get=function(t){return arguments.length>1&&(t=Array.apply(null,arguments)),t.reduce((function(e,r,n){if(e){var o=e[r];return n===t.length-1?o?o.data:void 0:o}}),this)},pt.prototype.set=function(t,e){return arguments.length>2&&(t=Array.prototype.slice.call(arguments,0,-1),e=arguments[arguments.length-1]),t.reduce((function(r,n,o){var i=r[n];return void 0===i&&(i=r[n]={}),o===t.length-1?(i.data=e,e):i}),this)},G.formatter=gt,s(G.prototype,{units:function(){if(void 0!==this._units)return this._units;var t=i(this.numerator,d),e=i(this.denominator,d);if(t&&e)return this._units="",this._units;var r=wt(this.numerator),n=wt(this.denominator);return this._units=r+(e?"":"/"+n),this._units},toString:function(e,n){var o;if(r(e))o=this.units(),n=e;else if(t(e))o=e;else if(K(e))return this.toPrec(e).toString(n);var i=this.to(o);return i=((void 0!==n?u(i.scalar,n):i.scalar)+" "+i.units()).trim()},format:function(t,e){1===arguments.length&&"function"==typeof t&&(e=t,t=void 0),e=e||G.formatter;var r=this.to(t);return e.call(this,r.scalar,r.units())}});var dt=new pt;function wt(t){var e=dt.get(t);return e||(e=i(t,d)?"1":bt(yt(t)).join("*"),dt.set(t,e),e)}function yt(t){for(var e,r,n=[],o=0;o<t.length;o++)e=t[o],r=t[o+1],y[e]?(n.push(M[e]+M[r]),o++):n.push(M[e]);return n}function bt(t){return t.reduce((function(t,e){var r=t[e];return r||t.push(r=t[e]=[e,0]),r[1]++,t}),[]).map((function(t){return t[0]+(t[1]>1?t[1]:"")}))}return G.version="1.7.6",G}()}(Ht);var Kt=Ht.exports;function Gt(t,e,r){if((e=Zt(e))===(r=Zt(r)))return t;try{return Kt.swiftConverter(e,r)(t)}catch(t){return}}function Zt(t){return t=(t=(t=t.replace(/C/g,"tempC")).replace(/F/g,"tempF")).replace(/(^|\W)K(\W|$)/g,"$1tempK$2")}const Jt=/^\/((?:\\\/|[^/])+)\/([migyu]{0,5})?$/;function Qt(t){const e=Jt.exec(t);if(!e)return te(t);try{return new RegExp(e[1],e[2])}catch(e){return te(t)}}function te(t,e="i"){return new RegExp(t.replace(/[[\]\\{}()+*?.$^|]/g,(function(t){return`\\${t}`})),e)}function ee(t,e){const r=void 0!==t.units&&t.units!==e?Gt(Array.from(t.data),t.units,e):t.data;return{units:e,label:t.label.replace(`[${t.units||""}]`,`[${e}]`),data:r||[],min:r?g(r):void 0,max:r?d(r):void 0,isMonotone:f(r)}}function re(t,e={}){const{units:r,label:n,variableName:o}=e;let i={...t};if(void 0!==r)for(let e in i){let n=Gt(1,t[e].units||"",r);i[e]=n?ee(t[e],r):void 0}if(void 0!==n)for(let e in i)t[e].label.match(n)||(i[e]=void 0);if(void 0!==o){if(i[o])return i[o];if(i[o.toUpperCase()])return i[o.toUpperCase()];if(i[o.toLowerCase()])return i[o.toLowerCase()]}const s=Object.values(i).filter((t=>void 0!==t));if(s.length>0)return s[0]}class ne{constructor(t={}){this.id=t.id||Math.random().toString(36).substring(2,10),this.label=t.label||this.id,this.spectrumCallback=t.spectrumCallback,this.spectra=[],this.cache={}}pushSpectrum(t,e={}){this.spectra.push(function(t,e,n){let{meta:o={},tmp:i={},dataType:s="",title:a=""}=e;const{spectrumCallback:l}=n;l&&l(t);let u=t.x,h=t.y;if(!u||!h)throw Error("A spectrum must contain at least x and y variables");if(!r(u.data)||!r(h.data))throw Error("x and y variables must contain an array data");let c=u.data,m=c&&c.length>1&&c[0]>c[c.length-1];for(let e in t){let r=t[e];m&&(r.data=r.data.reverse()),r.label=r.label||e,r.units=r.units||r.label.replace(/^.*[([](?<units>.*)[)\]].*$/,"$<units>"),r.min=g(r.data),r.max=d(r.data),r.isMonotone=f(r.data)}return{variables:t,title:a,dataType:s,meta:o,tmp:i}}(t,e,{spectrumCallback:this.spectrumCallback})),this.cache={}}getXYSpectrum(t={}){let e=JSON.stringify(t);return this.cache[e]||(this.cache[e]=function(t=[],e={}){if(!(t.length<1))for(let r of t){if(!(Object.keys(r.variables).length>1))continue;let{dataType:t,title:n,xUnits:o,yUnits:i,variables:s,xVariable:a="x",yVariable:l="y",units:u,labels:h,xLabel:c,yLabel:f,meta:m}=e;if(t&&(t=Qt(t),!r.dataType||!r.dataType.match(t)))continue;if(n&&(n=Qt(n),!r.title||!r.title.match(n)))continue;if(m&&"object"==typeof m){if(!r.meta)continue;for(let t in r.meta){if(!r.meta[t])continue;let e=Qt(r.meta[t]);r.meta[t].match(e)}}!u||o||i||([i,o]=u.split(/\s*vs\s*/)),!h||c||f||([f,c]=h.split(/\s*vs\s*/)),s&&([l,a]=s.split(/\s*vs\s*/)),c&&(c=Qt(c)),f&&(f=Qt(f));let p=re(r.variables,{units:o,label:c,variableName:a}),g=re(r.variables,{units:i,label:f,variableName:l});if(p&&g)return{title:r.title,dataType:r.dataType,meta:r.meta,variables:{x:p,y:g}}}}(this.spectra,t)),this.cache[e]}getXY(t={}){let e=this.getXYSpectrum(t);if(e)return{x:e.variables.x.data,y:e.variables.y.data}}getNormalizedSpectrum(t={}){const{normalization:e,selector:r}=t,n=this.getXYSpectrum(r);if(n)return Bt(n,e)}getSpectrum(){return this.spectra[0]}getXLabel(t){var e;return null===(e=this.getXYSpectrum(t))||void 0===e?void 0:e.variables.x.label}getYLabel(t){var e;return null===(e=this.getXYSpectrum(t))||void 0===e?void 0:e.variables.y.label}}const oe=["TIC",".RIC","SCANNUMBER"];function ie(t){let e=t.spectra,r=e.length,n={times:new Array(r),series:{ms:{dimension:2,data:new Array(r)}}},o=[];for(let t=0;t<oe.length;t++){let i=ae(oe[t]);e[0][i]&&(o.push(i),n.series[i]={dimension:1,data:new Array(r)})}for(let t=0;t<r;t++){let r=e[t];n.times[t]=r.pageValue;for(let e=0;e<o.length;e++)n.series[o[e]].data[t]=parseFloat(r[o[e]]);r.data&&(n.series.ms.data[t]=[r.data.x,r.data.y])}t.chromatogram=n}function se(t){return-1!==oe.indexOf(t)}function ae(t){return t.toLowerCase().replace(/[^a-z0-9]/g,"")}function le(t){let e=[];for(let r=0;r<t.length;r++)e.push(parseFloat(t[r]));return e}function ue(t,e){let r=t.yFactor,n=t.deltaX;t.isXYdata=!0;let o={x:[],y:[]};t.data=o;let i,s=t.firstX,a=t.firstY,l=!1,u=0;for(;u<e.length;u++)if(i=e.charCodeAt(u),13===i||10===i)l=!0;else if(l)break;let h=!0,c=!1,f=!1,m=0,p=!1,g=!1,d=0,w=0,y=!1,b=!1,v=!1,x=0;for(;u<=e.length;u++)if(i=u===e.length?13:e.charCodeAt(u),g)13!==i&&10!==i||(h=!0,g=!1);else if(i<=57&&i>=48)b=!0,x>0?d+=(i-48)/Math.pow(10,x++):(d*=10,d+=i-48);else if(44===i||46===i)b=!0,x++;else{if(b){if(h)h=!1,f&&(v=!0);else if(v)v=!1;else{c?(m=y?0-d:d,f=!0,c=!1):p||(w=y?0-d:d);let t=p?d-1:1;for(let e=0;e<t;e++)f?a+=m:a=w,o.x.push(s),o.y.push(a*r),s+=n}y=!1,d=0,x=0,b=!1,p=!1}if(i<74&&i>63)b=!0,f=!1,d=i-64;else if(i>96&&i<106)b=!0,f=!1,d=i-96,y=!0;else if(115===i)b=!0,p=!0,d=9;else if(i>82&&i<91)b=!0,p=!0,d=i-82;else if(i>73&&i<83)b=!0,c=!0,d=i-73;else if(i>105&&i<115)b=!0,c=!0,d=i-105,y=!0;else if(36===i&&36===e.charCodeAt(u+1))b=!0,g=!0;else if(37===i)b=!0,c=!0,d=0,y=!1;else if(45===i){let t=e.charCodeAt(u+1);(t>=48&&t<=57||44===t||46===t)&&(b=!0,h||(f=!1),y=!0)}else 13!==i&&10!==i||(h=!0,g=!1)}}const he=/\$\$.*/,ce=/[,\t ]+/;function fe(t,e,r){if(t.isPeaktable=!0,t.variables&&2!==Object.keys(t.variables)?function(t,e,r){let n={},o=Object.keys(t.variables),i=o.length;o.forEach((t=>n[t]=[])),t.data=n;let s=e.split(/,? *,?[;\r\n]+ */);for(let t=1;t<s.length;t++){let e=s[t].trim().replace(he,"").split(ce);if(e.length%i==0)for(let t=0;t<e.length;t++)n[o[t%i]].push(parseFloat(e[t]));else r.logs.push(`Format error: ${e}`)}}(t,e,r):function(t,e,r){let n={x:[],y:[]};t.data=n;let o=e.split(/,? *,?[;\r\n]+ */);for(let e=1;e<o.length;e++){let i=o[e].trim().replace(he,"").split(ce);if(i.length%2==0)for(let e=0;e<i.length;e+=2)n.x.push(parseFloat(i[e])*t.xFactor),n.y.push(parseFloat(i[e+1])*t.yFactor);else r.logs.push(`Format error: ${i}`)}}(t,e,r),t.variables)for(let e in t.variables)t.variables[e].data=t.data[e]}function me(t,e){let r,n=/(\(+|\)+|<+|>+|\s+)/g;t.isXYAdata=!0;let o={x:[],y:[]};t.data=o;let i=e.split(/,? *,?[;\r\n]+ */);for(let t=1;t<i.length;t++)r=i[t].trim().replace(n,"").split(","),o.x.push(parseFloat(r[0])),o.y.push(parseFloat(r[1]))}function pe(t,e){let r=function(t){let e=t[0].data.y[0],r=e,n=t.length,o=t[0].data.x.length,s=new Array(n);for(let i=0;i<n;i++){s[i]=t[i].data.y;for(let t=0;t<o;t++){let n=s[i][t];n<e&&(e=n),n>r&&(r=n)}}const a=t[0].data.x[0],l=t[0].data.x[t[0].data.x.length-1],u=t[0].pageValue,h=t[n-1].pageValue;if(a>l)for(let t of s)t.reverse();u>h&&s.reverse();const c=[];for(let t=0;t<s.length;t++){const e=Float64Array.from(s[t]);for(let t=0;t<e.length;t++)e[t]<0&&(e[t]=-e[t]);c.push(i(e))}const f=i(c);return{z:s,minX:Math.min(a,l),maxX:Math.max(a,l),minY:Math.min(u,h),maxY:Math.max(u,h),minZ:e,maxZ:r,noise:f}}(t.spectra);e.noContour||(t.contourLines=function(t,e){let r,n,o,i,s,a,l,u,h,c,f,m,p,g=t.noise,d=t.z,w=d.length,y=d[0].length,b=t.minX,v=(t.maxX-b)/(y-1),x=t.minY,M=(t.maxY-x)/(w-1),E=t.minZ,A=t.maxZ,S=2*e.nbContourLevels,T=new Array(S);for(let t=0;t<S;t++){let S={};T[t]=S;let k=t%2,F=(A-e.noiseMultiplier*g)*Math.exp((t>>1)-e.nbContourLevels);p=0===k?F+e.noiseMultiplier*g:0-F-e.noiseMultiplier*g;let N=[];if(S.zValue=p,S.lines=N,!(p<=E||p>=A))for(let t=0;t<w-1;t++){let e=d[t],g=d[t+1];for(let d=0;d<y-1;d++)r=e[d],n=e[d+1],o=g[d],i=g[d+1],s=r>p,a=n>p,l=o>p,u=i>p,s!==a&&s!==l&&(h=d+(p-r)/(n-r),c=t,f=d,m=t+(p-r)/(o-r),N.push(h*v+b),N.push(c*M+x),N.push(f*v+b),N.push(m*M+x)),u!==a&&u!==l&&(h=d+1,c=t+1-(p-i)/(n-i),f=d+1-(p-i)/(o-i),m=t+1,N.push(h*v+b),N.push(c*M+x),N.push(f*v+b),N.push(m*M+x)),a!==l&&(h=(d+1-(p-n)/(o-n))*v+b,c=(t+(p-n)/(o-n))*M+x,a!==s&&(f=d+1-(p-n)/(r-n),m=t,N.push(h),N.push(c),N.push(f*v+b),N.push(m*M+x)),l!==s&&(f=d,m=t+1-(p-o)/(r-o),N.push(h),N.push(c),N.push(f*v+b),N.push(m*M+x)),a!==u&&(f=d+1,m=t+(p-n)/(i-n),N.push(h),N.push(c),N.push(f*v+b),N.push(m*M+x)),l!==u&&(f=d+(p-o)/(i-o),m=t+1,N.push(h),N.push(c),N.push(f*v+b),N.push(m*M+x)))}}return{minX:t.minX,maxX:t.maxX,minY:t.minY,maxY:t.maxY,segments:T}}(r,e),delete r.z),t.minMax=r}const ge={"1H":267522187.44,"2H":41065e3,"3H":285350800,"3He":-203789e3,"7Li":103962e3,"13C":67282840,"14N":19331e3,"15N":-27116e3,"17O":-36264e3,"19F":251662e3,"23Na":70761e3,"27Al":69763e3,"29Si":-5319e4,"31P":108291e3,"57Fe":8681e3,"63Cu":71118e3,"67Zn":16767e3,"129Xe":-73997e3};function de(t,e,r){t.profiling&&t.profiling.push({action:e,time:Date.now()-r.start})}function we(t){let e=t.spectra[0].data;t.chromatogram={times:e.x.slice(),series:{intensity:{dimension:1,data:e.y.slice()}}}}function ye(t,e,r){!function(t){for(let e of t){let t=0,r=0;for(let n of e.spectra){if(e.ntuples&&e.ntuples.symbol?(!t&&n.observeFrequency&&(t=n.observeFrequency),!r&&n.shiftOffsetVal&&(r=n.shiftOffsetVal)):(t=n.observeFrequency,r=n.shiftOffsetVal),t&&n.xUnits&&n.xUnits.toUpperCase().includes("HZ")){n.xUnits="PPM",n.xFactor=n.xFactor/t,n.firstX=n.firstX/t,n.lastX=n.lastX/t,n.deltaX=n.deltaX/t;for(let e=0;e<n.data.x.length;e++)n.data.x[e]/=t}if(r){let t=n.firstX-r;n.firstX=n.firstX-t,n.lastX=n.lastX-t;for(let e=0;e<n.data.x.length;e++)n.data.x[e]-=t}if(e.ntuples&&e.ntuples.nucleus&&e.ntuples.symbol)for(let t=0;t<e.ntuples.nucleus.length;t++){let r=e.ntuples.symbol[t],n=e.ntuples.nucleus[t];if(r.startsWith("F")&&!n){if("F1"===r)if(e.tmp.$NUC2)e.ntuples.nucleus[t]=e.tmp.$NUC2;else{let r=e.ntuples.symbol.indexOf("F2");r&&e.ntuples.nucleus[r]&&(e.ntuples.nucleus[t]=e.ntuples.nucleus[r])}"F2"===r&&(e.ntuples.nucleus[t]=e.tmp.$NUC1)}"F2"===r&&(e.yType=e.ntuples.nucleus[0])}if(t&&e.ntuples&&e.ntuples.symbol&&e.ntuples.nucleus){let r="",o=e.ntuples.symbol.indexOf(n.pageSymbol);if(e.ntuples.units&&e.ntuples.units[o]&&(r=e.ntuples.units[o]),"PPM"!==r){if(0!==o)throw Error("Not sure about this ntuples format");let r=ge[e.ntuples.nucleus[0]],i=ge[e.ntuples.nucleus[1]];if(!r||!i)throw Error("Problem with determination of gyromagnetic ratio");let s=r/i*t;n.pageValue/=s}}}}}(t);for(let n of t){if(Object.keys(n.ntuples).length>0){let t=[],e=Object.keys(n.ntuples);for(let r=0;r<e.length;r++){let o=e[r],i=n.ntuples[o];for(let e=0;e<i.length;e++)t[e]||(t[e]={}),t[e][o]=i[e]}n.ntuples=t}n.twoD&&r.wantXY&&(pe(n,r),de(e,"Finished countour plot calculation",r),r.keepSpectra||delete n.spectra),r.chromatogram&&(n.spectra.length>1?ie(n):we(n),de(e,"Finished chromatogram calculation",r)),delete n.tmp}}function be(t,e,r){let n=-1,o=-1,i="",s="";if(r.indexOf("++")>0)i=r.replace(/.*\(([a-zA-Z0-9]+)\+\+.*/,"$1"),s=r.replace(/.*\.\.([a-zA-Z0-9]+).*/,"$1");else{i=(r=r.replace(/[^a-zA-Z]/g,"")).charAt(0),s=r.charAt(1),e.variables={};for(let n of r){let r=n.toLowerCase(),o=t.ntuples.symbol.indexOf(n);if(-1===o)throw Error(`Symbol undefined: ${n}`);e.variables[r]={};for(let n in t.ntuples)t.ntuples[n][o]&&(e.variables[r][n.replace(/^var/,"")]=t.ntuples[n][o])}}n=t.ntuples.symbol.indexOf(i),o=t.ntuples.symbol.indexOf(s),-1===n&&(n=0),-1===o&&(o=0),t.ntuples.first&&(t.ntuples.first.length>n&&(e.firstX=t.ntuples.first[n]),t.ntuples.first.length>o&&(e.firstY=t.ntuples.first[o])),t.ntuples.last&&(t.ntuples.last.length>n&&(e.lastX=t.ntuples.last[n]),t.ntuples.last.length>o&&(e.lastY=t.ntuples.last[o])),t.ntuples.vardim&&t.ntuples.vardim.length>n&&(e.nbPoints=t.ntuples.vardim[n]),t.ntuples.factor&&(t.ntuples.factor.length>n&&(e.xFactor=t.ntuples.factor[n]),t.ntuples.factor.length>o&&(e.yFactor=t.ntuples.factor[o])),t.ntuples.units&&(t.ntuples.units.length>n&&(t.ntuples.varname&&t.ntuples.varname[n]?e.xUnits=`${t.ntuples.varname[n]} [${t.ntuples.units[n]}]`:e.xUnits=t.ntuples.units[n]),t.ntuples.units.length>o&&(t.ntuples.varname&&t.ntuples.varname[o]?e.yUnits=`${t.ntuples.varname[o]} [${t.ntuples.units[o]}]`:e.yUnits=t.ntuples.units[o]))}function ve(t){t.xFactor||(t.xFactor=1),t.yFactor||(t.yFactor=1)}const xe=/[ \t]*,[ \t]*/;class Me{}const Ee={keepRecordsRegExp:/^$/,canonicDataLabels:!0,canonicMetadataLabels:!1,dynamicTyping:!0,withoutXY:!1,chromatogram:!1,keepSpectra:!1,noContour:!1,nbContourLevels:7,noiseMultiplier:5,profiling:!1};function Ae(t,e={}){t=function(t,e={}){const{encoding:r="utf8"}=e;if(ArrayBuffer.isView(t)||t instanceof ArrayBuffer)return new TextDecoder(r).decode(t);return t}(t),(e={...Ee,...e}).wantXY=!e.withoutXY,e.start=Date.now();let r=[],n={profiling:!!e.profiling&&[],logs:[],entries:[]},o={children:[]},i=o,s=[],a=new Me;if("string"!=typeof t)throw new TypeError("the JCAMP should be a string");de(n,"Before split to LDRS",e);let l=t.replace(/[\r\n]+##/g,"\n##").split("\n##");de(n,"Split to LDRS",e),l[0]&&(l[0]=l[0].replace(/^[\r\n ]*##/,""));for(let t of l){let o=t.indexOf("="),l=o>0?t.substring(0,o):t,u=o>0?t.substring(o+1).trim():"",h=l.replace(/[_ -]/g,"").toUpperCase();if("DATATABLE"===h){let t=u.indexOf("\n");if(-1===t&&(t=u.indexOf("\r")),t>0){let e=u.substring(0,t).split(/[ ,;\t]+/);be(i,a,e[0]),a.datatable=e[0],e[1]&&e[1].indexOf("PEAKS")>-1?h="PEAKTABLE":e[1]&&(e[1].indexOf("XYDATA")||e[0].indexOf("++")>0)&&(h="XYDATA",a.deltaX=(a.lastX-a.firstX)/(a.nbPoints-1))}}if("XYDATA"!==h)if("PEAKTABLE"!==h)if("PEAKASSIGNMENTS"!==h){if("TITLE"===h){let t=i;t.children||(t.children=[]),i={spectra:[],ntuples:{},info:{},meta:{},tmp:{}},t.children.push(i),s.push(t),r.push(i),i.title=u}else"DATATYPE"===h?(i.dataType=u,u.match(/(^nd|\snd\s)/i)&&(i.twoD=!0)):"NTUPLES"===h?u.match(/(^nd|\snd\s)/i)&&(i.twoD=!0):"DATACLASS"===h?i.dataClass=u:"XUNITS"===h?a.xUnits=u:"YUNITS"===h?a.yUnits=u:"FIRSTX"===h?a.firstX=parseFloat(u):"LASTX"===h?a.lastX=parseFloat(u):"FIRSTY"===h?a.firstY=parseFloat(u):"LASTY"===h?a.lastY=parseFloat(u):"NPOINTS"===h?a.nbPoints=parseFloat(u):"XFACTOR"===h?a.xFactor=parseFloat(u):"YFACTOR"===h?a.yFactor=parseFloat(u):"MAXX"===h?a.maxX=parseFloat(u):"MINX"===h?a.minX=parseFloat(u):"MAXY"===h?a.maxY=parseFloat(u):"MINY"===h?a.minY=parseFloat(u):"DELTAX"===h?a.deltaX=parseFloat(u):".OBSERVEFREQUENCY"===h||"$SFO1"===h?a.observeFrequency||(a.observeFrequency=parseFloat(u)):".OBSERVENUCLEUS"===h?a.xType||(i.xType=u.replace(/[^a-zA-Z0-9]/g,"")):"$OFFSET"===h?(i.shiftOffsetNum=0,a.shiftOffsetVal||(a.shiftOffsetVal=parseFloat(u))):"$REFERENCEPOINT"===h||("VARNAME"===h?i.ntuples.varname=u.split(xe):"SYMBOL"===h?i.ntuples.symbol=u.split(xe):"VARTYPE"===h?i.ntuples.vartype=u.split(xe):"VARFORM"===h?i.ntuples.varform=u.split(xe):"VARDIM"===h?i.ntuples.vardim=le(u.split(xe)):"UNITS"===h?i.ntuples.units=u.split(xe):"FACTOR"===h?i.ntuples.factor=le(u.split(xe)):"FIRST"===h?i.ntuples.first=le(u.split(xe)):"LAST"===h?i.ntuples.last=le(u.split(xe)):"MIN"===h?i.ntuples.min=le(u.split(xe)):"MAX"===h?i.ntuples.max=le(u.split(xe)):".NUCLEUS"===h?i.ntuples&&(i.ntuples.nucleus=u.split(xe)):"PAGE"===h?(a.page=u.trim(),a.pageValue=parseFloat(u.replace(/^.*=/,"")),a.pageSymbol=a.page.replace(/[=].*/,"")):"RETENTIONTIME"===h?a.pageValue=parseFloat(u):se(h)?a[ae(h)]=u:"SAMPLEDESCRIPTION"===h?a.sampleDescription=u:h.startsWith("$NUC")?i.tmp[h]||u.includes("off")||(i.tmp[h]=u.replace(/[<>]/g,"")):"END"===h&&(i=s.pop()));if(i&&i.info&&i.meta&&h.match(e.keepRecordsRegExp)){let t,r,n=u.trim();l.startsWith("$")?(r=e.canonicMetadataLabels?h.substring(1):l.substring(1),t=i.meta):(r=e.canonicDataLabels?h:l,t=i.info),e.dynamicTyping&&("true"===n||"TRUE"===n?n=!0:"false"===n||"FALSE"===n?n=!1:""===n||isNaN(n)||(n=parseFloat(n))),t[r]?(Array.isArray(t[r])||(t[r]=[t[r]]),t[r].push(n)):t[r]=n}}else e.wantXY&&(u.match(/.*(XYA).*/)&&me(a,u),i.spectra.push(a),a=new Me);else e.wantXY&&(ve(a),fe(a,u,n),i.spectra.push(a),a=new Me);else e.wantXY&&(ve(a),u.match(/.*\+\+.*/)?(a.deltaX=(a.lastX-a.firstX)/(a.nbPoints-1),ue(a,u)):fe(a,u,n),i.spectra.push(a),a=new Me)}return de(n,"Finished parsing",e),ye(r,n,e),de(n,"Total time",e),n.entries=o.children,n.flatten=r,n}function Se(t,e={}){let r=new ne(e);return function(t,e){let r=Ae(e,{keepRecordsRegExp:/.*/});for(let e of r.flatten){let r=e.spectra[0];if(r.variables)for(let t in r.variables){const e=r.variables[t];e.label||(e.label=e.name||e.symbol||t,e.units&&!e.label.includes(e.units)&&(e.label+=` [${e.units}]`))}else{const t={};r.variables=t,t.x={label:r.xUnits,symbol:"X",data:r.data.x||r.data.X},t.y={label:r.yUnits,symbol:"Y",data:r.data.y||r.data.Y}}t.pushSpectrum(r.variables,{dataType:e.dataType,title:e.title,meta:e.meta})}}(r,t),r}function Te(t={},e={}){const{info:r,meta:n,forceNtuples:o}=e;let i={info:r,meta:n},s=Object.keys(t).map((t=>t.toLowerCase()));if(2===s.length&&s.includes("x")&&s.includes("y")&&!o){let e=t.x,r=e.label||e.name||"x";i.info.xUnits=r.includes(t.x.units)?r:`${r} [${t.x.units}]`;let n=t.y,o=n.label||n.name||"y";return i.info.yUnits=o.includes(t.y.units)?o:`${o} [${t.y.units}]`,function(t,e={}){const{meta:r={},info:n={}}=e,{title:o="",owner:i="",origin:s="",dataType:a="",xUnits:l="",yUnits:u=""}=n;let h=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,f=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,p=[];for(let e=0;e<t.x.length;e++){let r=t.x[e],n=t.y[e];h>r&&(h=r),c<r&&(c=r),f>n&&(f=n),m<n&&(m=n),p.push(`${r} ${n}`)}let g=`##TITLE=${o}\n##JCAMP-DX=4.24\n##DATA TYPE=${a}\n##ORIGIN=${s}\n##OWNER=${i}\n##XUNITS=${l}\n##YUNITS=${u}\n##FIRSTX=${h}\n##LASTX=${c}\n##FIRSTY=${f}\n##LASTY=${m}\n`;for(const t in r)g+="cheminfo"===t.toLowerCase()?`##$${t}=${JSON.stringify(r[t])}\n`:`##$${t}=${r[t]}\n`;return`${g}##NPOINTS=${p.length}\n##PEAK TABLE=(XY..XY)\n${p.join("\n")}\n##END`}({x:t.x.data,y:t.y.data},i)}return function(t,e){const{meta:r={},info:n={}}=e,{title:o="",owner:i="",origin:s="",dataType:a=""}=n,l=[],u=[],h=[],c=[],f=[],m=[],p=[],w=[],y=[],b=Object.keys(t);for(let e=0;e<b.length;e++){const r=b[e];let n=t[r],o=n.label&&n.label.replace(/ *\[.*/,""),i=n.label&&n.label.replace(/.*\[(.*)\].*/,"$1");l.push(n.symbol||r),u.push(n.name||o||r),c.push(t[r].data.length),h.push(n.type?n.type.toUpperCase():0===e?"INDEPENDENT":"DEPENDENT"),f.push(n.units||i||""),m.push(t[r][0]),p.push(t[r][t[r].length-1]),w.push(g(t[r].data)),y.push(d(t[r].data))}let v=`##TITLE=${o}\n##JCAMP-DX=6.00\n##DATA TYPE=${a}\n##ORIGIN=${s}\n##OWNER=${i}\n`;for(const t in r)v+="object"==typeof r[t]?`##$${t}=${JSON.stringify(r[t])}\n`:`##$${t}=${r[t]}\n`;v+=`##NTUPLES= ${a}\n##VAR_NAME=  ${u.join()}\n##SYMBOL=    ${l.join()}\n##VAR_TYPE=  ${h.join()}\n##VAR_DIM=   ${c.join()}\n##UNITS=     ${f.join()}\n##PAGE= N=1\n`,v+=`##DATA TABLE= (${l.join("")}..${l.join("")}), PEAKS\n`;for(let e=0;e<t[b[0]].data.length;e++){let r=[];for(let n of b)r.push(t[n].data[e]);v+=`${r.join("\t")}\n`}return v+="##END",v}(t,e)}function ke(t,e){const{info:r={},meta:n={}}=e;let o={options:{},info:{title:t.title,dataType:t.dataType,...r},meta:{...t.meta,...n}};return Te(t.variables,o)}function Fe(t,e,r=1,n={}){const{showKind:o=!0,showAssignment:i=!0}=n;let s=[],a=0;o&&(s.push({text:e.kind,size:"18px",anchor:"middle",color:"red",position:{x:e.wavenumber,y:e.transmittance*r,dy:23+14*a+"px"}}),a++),i&&(s.push({text:e.assignment,size:"18px",anchor:"middle",color:"darkred",position:{x:e.wavenumber,y:e.transmittance*r,dy:23+14*a+"px"}}),a++),t.labels=s,t.position=[{x:e.wavenumber,y:e.transmittance*r,dy:"10px",dx:"-1px"},{x:e.wavenumber,y:e.transmittance*r,dy:"5px",dx:"1px"}]}function Ne(t){let e=t.y,r=!0;if(e.label.toLowerCase().includes("trans")&&(r=!1),r)t.a={...e},t.a.data=t.a.data.slice(),t.t={data:e.data.map((t=>10**-t*100)),label:"Transmittance (%)",units:""};else{const r=e.label.includes("%")||e.label.toLowerCase().includes("percent")?100:1;t.a={data:e.data.map((t=>-Math.log10(t/r))),label:"Absorbance",units:""},100===r?(t.t={...e},t.t.data=t.t.data.slice()):t.t={units:"",label:"Transmittance (%)",data:e.data.map((t=>100*t))}}}const Re={...{getJSGraph:function(t,e={}){const{colors:r=dt,opacities:n=[1],linesWidth:o=[1],selector:i={},normalization:s,xAxis:a={},yAxis:l={}}=e;let u=[],h="",c="";for(let e=0;e<t.length;e++){const l=t[e];let f={},m=l.getNormalizedSpectrum({selector:i,normalization:s});m&&(h||(h=m.variables.x.label),c||(c=m.variables.y.label),gt(f,l,{color:r[e%r.length],opacity:n[e%n.length],lineWidth:o[e%o.length]}),f.data={x:m.variables.x.data,y:m.variables.y.data},a.logScale&&(f.data=v(f.data)),u.push(f))}return{axes:{x:{label:h,unit:"",flipped:!1,display:!0,...a},y:{label:c,unit:"",flipped:!1,display:!0,...l}},series:u}},getNormalizationAnnotations:function(t={},e={y:{min:"0px",max:"2000px"}}){let{exclusions:r=[]}=t,n=[];return r=r.filter((t=>!t.ignore)),n=r.map((t=>({type:"rect",position:[{x:t.from,y:e.y.min},{x:t.to,y:e.y.max}],strokeWidth:0,fillColor:"rgba(255,255,224,1)"}))),void 0!==t.from&&n.push({type:"rect",position:[{x:Number.MIN_SAFE_INTEGER,y:e.y.min},{x:t.from,y:e.y.max}],strokeWidth:0,fillColor:"rgba(255,255,224,1)"}),void 0!==t.to&&n.push({type:"rect",position:[{x:t.to,y:e.y.min},{x:Number.MAX_SAFE_INTEGER,y:e.y.max}],strokeWidth:0,fillColor:"rgba(255,255,224,1)"}),n}},getAnnotations:function(t,e={}){const{fillColor:r="green",strokeColor:n="red",creationFct:o,mode:i="t100"}=e;return t.map((t=>{let s={line:1,type:"rect",strokeColor:n,strokeWidth:0,fillColor:r};switch(o&&o(s,t),i){case"a":!function(t,e,r={}){const{showKind:n=!0,showAssignment:o=!0,assignmentAngle:i=-45}=r;let s=[],a=0;n&&(s.push({text:e.kind,size:"18px",anchor:"middle",color:"red",position:{x:e.wavenumber,y:e.absorbance,dy:-15-14*a+"px"}}),a++);o&&(s.push({text:e.assignment,size:"18px",angle:i,anchor:"left",color:"darkred",position:{x:e.wavenumber,y:e.absorbance,dy:-15-14*a+"px"}}),a++);t.labels=s,t.position=[{x:e.wavenumber,y:e.absorbance,dy:"-10px",dx:"-1px"},{x:e.wavenumber,y:e.absorbance,dy:"-5px",dx:"1px"}]}(s,t,e);break;case"t":Fe(s,t,1,e);break;case"t100":Fe(s,t,100,e)}return s}))}};t.AnalysesManager=class{constructor(){this.analyses=[]}addAnalysis(t){let e=this.getAnalysisIndex(t.id);void 0===e?this.analyses.push(t):this.analyses[e]=t}getAnalyses(t={}){const{ids:e}=t;let r=[];for(const t of this.analyses)e&&!e.includes(t.id)||r.push(t);return r}getSpectra(){const t=[];for(const e of this.analyses)t.push(...e.spectra);return t}getDistinctTitles(){let t={};for(let e of this.getSpectra())e.title&&yt(t,e.title);return Object.keys(t).map((e=>t[e]))}getDistinctUnits(){var t;let e={};for(let r of this.getSpectra())if(r.variables)for(let n in r.variables){const o=null===(t=r.variables[n].units)||void 0===t?void 0:t.replace(/\s+\[.*/,"");o&&yt(e,o)}return Object.keys(e).map((t=>e[t]))}getDistinctLabels(){let t={};for(let e of this.getSpectra())if(e.variables)for(let r in e.variables)yt(t,e.variables[r].label.replace(/\s+\[.*/,""));return Object.keys(t).map((e=>t[e]))}getDistinctDataTypes(){let t={};for(let e of this.getSpectra())e.dataType&&yt(t,e.dataType);return Object.keys(t).map((e=>t[e]))}getDistinctMeta(){let t={};for(let e of this.getSpectra())if(e.meta)for(let r in e.meta)wt(t,r,e.meta[r]);return Object.keys(t).map((e=>t[e]))}removeAllAnalyses(){this.analyses.splice(0)}removeAnalysis(t){let e=this.getAnalysisIndex(t);if(void 0!==e)return this.analyses.splice(e,1)}getAnalysisIndex(t){if(t)for(let e=0;e<this.analyses.length;e++){if(this.analyses[e].id===t)return e}}includes(t){const e=this.getAnalysisIndex(t);return void 0!==e&&!isNaN(e)}},t.Analysis=ne,t.JSGraph=Re,t.autoPeakPicking=function(t,e={}){var r,n;const{xVariable:o="x",yVariable:i="y",normalizationOptions:s,minPeakWidth:a}=e;let l=null===(r=t.variables[o])||void 0===r?void 0:r.data,u=null===(n=t.variables[i])||void 0===n?void 0:n.data;if(s){const t=Bt({variables:{x:{data:l,label:""},y:{data:u,label:""}}},s);l=t.variables.x.data,u=t.variables.y.data}if(!l||!u)return;let{from:h,to:c}=e,f=D({x:l,y:u},e);if(s){const r=void 0===e.maxCriteria||e.maxCriteria?x:M;for(let e of f){const n=r({x:t.variables.x.data,y:t.variables.y.data},{target:e.x});e.x=n.x,e.y=n.y}}return void 0!==h&&(f=f.filter((t=>t.x>=h))),void 0!==c&&(f=f.filter((t=>t.x<=c))),a&&(f=f.filter((t=>t.width>=a))),f.map((e=>{const r={};for(let n in t.variables)r[n]=t.variables[n].data[e.index];return r.width=e.width,r}))},t.fromJcamp=function(t,e){return Se(t,{...e,spectrumCallback:Ne})},t.peakPicking=function(t,e,r={}){var n,o;const{xVariable:i="x",yVariable:s="y",optimize:a=!1,max:l=!0}=r,h=null===(n=t.variables[i])||void 0===n?void 0:n.data,c=null===(o=t.variables[s])||void 0===o?void 0:o.data;if(!h||!c)return;let f;f=a?l?x({x:h,y:c},{target:e}).index:M({x:h,y:c},{target:e}).index:u(h,e);const m={};for(let e in t.variables)m[e]=t.variables[e].data[f];return m},t.toJcamp=function(t,e={}){return function(t,e={}){let r=[];for(let n of t.spectra)r.push(ke(n,e));return r}(t,e).join("\n")},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=raman-spectrum.min.js.map
